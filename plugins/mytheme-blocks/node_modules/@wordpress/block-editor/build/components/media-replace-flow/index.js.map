{"version":3,"sources":["@wordpress/block-editor/src/components/media-replace-flow/index.js"],"names":["MediaReplaceFlow","mediaURL","mediaId","allowedTypes","accept","onSelect","onSelectURL","onError","name","showURLInput","setShowURLInput","showEditURLInput","setShowEditURLInput","mediaURLValue","setMediaURLValue","mediaUpload","select","getSettings","editMediaButtonRef","stopPropagation","event","stopPropagationRelevantKeys","LEFT","DOWN","RIGHT","UP","BACKSPACE","ENTER","indexOf","keyCode","selectMedia","media","url","selectURL","newURL","uploadFiles","closeDropdown","files","target","setMedia","filesList","onFileChange","openOnArrowDown","preventDefault","click","urlInputUIContent","current","focus","isOpen","onToggle","onClose","open","openFileDialog","upload","link","withNotices"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useState, createRef } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\nimport { speak } from '@wordpress/a11y';\nimport {\n\tFormFileUpload,\n\tNavigableMenu,\n\tMenuItem,\n\tToolbarGroup,\n\tButton,\n\tDropdown,\n\twithNotices,\n} from '@wordpress/components';\nimport { LEFT, RIGHT, UP, DOWN, BACKSPACE, ENTER } from '@wordpress/keycodes';\nimport { useSelect } from '@wordpress/data';\nimport { compose } from '@wordpress/compose';\nimport { link, upload } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport MediaUpload from '../media-upload';\nimport MediaUploadCheck from '../media-upload/check';\nimport LinkEditor from '../url-popover/link-editor';\nimport LinkViewer from '../url-popover/link-viewer';\n\nconst MediaReplaceFlow = ( {\n\tmediaURL,\n\tmediaId,\n\tallowedTypes,\n\taccept,\n\tonSelect,\n\tonSelectURL,\n\tonError,\n\tname = __( 'Replace' ),\n} ) => {\n\tconst [ showURLInput, setShowURLInput ] = useState( false );\n\tconst [ showEditURLInput, setShowEditURLInput ] = useState( false );\n\tconst [ mediaURLValue, setMediaURLValue ] = useState( mediaURL );\n\tconst mediaUpload = useSelect( ( select ) => {\n\t\treturn select( 'core/block-editor' ).getSettings().mediaUpload;\n\t}, [] );\n\tconst editMediaButtonRef = createRef();\n\n\tconst stopPropagation = ( event ) => {\n\t\tevent.stopPropagation();\n\t};\n\n\tconst stopPropagationRelevantKeys = ( event ) => {\n\t\tif (\n\t\t\t[ LEFT, DOWN, RIGHT, UP, BACKSPACE, ENTER ].indexOf(\n\t\t\t\tevent.keyCode\n\t\t\t) > -1\n\t\t) {\n\t\t\t// Stop the key event from propagating up to ObserveTyping.startTypingInTextField.\n\t\t\tevent.stopPropagation();\n\t\t}\n\t};\n\n\tconst selectMedia = ( media ) => {\n\t\tonSelect( media );\n\t\tsetMediaURLValue( media.url );\n\t\tspeak( __( 'The media file has been replaced' ) );\n\t};\n\n\tconst selectURL = ( newURL ) => {\n\t\tonSelectURL( newURL );\n\t\tsetShowEditURLInput( false );\n\t};\n\n\tconst uploadFiles = ( event, closeDropdown ) => {\n\t\tconst files = event.target.files;\n\t\tconst setMedia = ( [ media ] ) => {\n\t\t\tselectMedia( media );\n\t\t\tcloseDropdown();\n\t\t};\n\t\tmediaUpload( {\n\t\t\tallowedTypes,\n\t\t\tfilesList: files,\n\t\t\tonFileChange: setMedia,\n\t\t\tonError,\n\t\t} );\n\t};\n\n\tconst openOnArrowDown = ( event ) => {\n\t\tif ( event.keyCode === DOWN ) {\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t\tevent.target.click();\n\t\t}\n\t};\n\n\tlet urlInputUIContent;\n\tif ( showEditURLInput ) {\n\t\turlInputUIContent = (\n\t\t\t<LinkEditor\n\t\t\t\tonKeyDown={ stopPropagationRelevantKeys }\n\t\t\t\tonKeyPress={ stopPropagation }\n\t\t\t\tvalue={ mediaURLValue }\n\t\t\t\tisFullWidthInput={ true }\n\t\t\t\thasInputBorder={ true }\n\t\t\t\tonChangeInputValue={ ( url ) => setMediaURLValue( url ) }\n\t\t\t\tonSubmit={ ( event ) => {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tselectURL( mediaURLValue );\n\t\t\t\t\teditMediaButtonRef.current.focus();\n\t\t\t\t} }\n\t\t\t/>\n\t\t);\n\t} else {\n\t\turlInputUIContent = (\n\t\t\t<LinkViewer\n\t\t\t\tisFullWidth={ true }\n\t\t\t\tclassName=\"block-editor-media-replace-flow__link-viewer\"\n\t\t\t\turl={ mediaURLValue }\n\t\t\t\tonEditLinkClick={ () =>\n\t\t\t\t\tsetShowEditURLInput( ! showEditURLInput )\n\t\t\t\t}\n\t\t\t/>\n\t\t);\n\t}\n\n\treturn (\n\t\t<Dropdown\n\t\t\tcontentClassName=\"block-editor-media-replace-flow__options\"\n\t\t\trenderToggle={ ( { isOpen, onToggle } ) => (\n\t\t\t\t<ToolbarGroup className=\"media-replace-flow\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\tref={ editMediaButtonRef }\n\t\t\t\t\t\taria-expanded={ isOpen }\n\t\t\t\t\t\tonClick={ onToggle }\n\t\t\t\t\t\tonKeyDown={ openOnArrowDown }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ name }\n\t\t\t\t\t\t<span className=\"block-editor-media-replace-flow__indicator\" />\n\t\t\t\t\t</Button>\n\t\t\t\t</ToolbarGroup>\n\t\t\t) }\n\t\t\trenderContent={ ( { onClose } ) => (\n\t\t\t\t<>\n\t\t\t\t\t<NavigableMenu>\n\t\t\t\t\t\t<MediaUpload\n\t\t\t\t\t\t\tvalue={ mediaId }\n\t\t\t\t\t\t\tonSelect={ ( media ) => selectMedia( media ) }\n\t\t\t\t\t\t\tallowedTypes={ allowedTypes }\n\t\t\t\t\t\t\trender={ ( { open } ) => (\n\t\t\t\t\t\t\t\t<MenuItem icon=\"admin-media\" onClick={ open }>\n\t\t\t\t\t\t\t\t\t{ __( 'Open Media Library' ) }\n\t\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<MediaUploadCheck>\n\t\t\t\t\t\t\t<FormFileUpload\n\t\t\t\t\t\t\t\tonChange={ ( event ) => {\n\t\t\t\t\t\t\t\t\tuploadFiles( event, onClose );\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\taccept={ accept }\n\t\t\t\t\t\t\t\trender={ ( { openFileDialog } ) => {\n\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\t\t\t\ticon={ upload }\n\t\t\t\t\t\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\t\t\t\t\t\topenFileDialog();\n\t\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{ __( 'Upload' ) }\n\t\t\t\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</MediaUploadCheck>\n\t\t\t\t\t\t{ onSelectURL && (\n\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\ticon={ link }\n\t\t\t\t\t\t\t\tonClick={ () =>\n\t\t\t\t\t\t\t\t\tsetShowURLInput( ! showURLInput )\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\taria-expanded={ showURLInput }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div> { __( 'Insert from URL' ) } </div>\n\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</NavigableMenu>\n\t\t\t\t\t{ showURLInput && (\n\t\t\t\t\t\t<div className=\"block-editor-media-flow__url-input\">\n\t\t\t\t\t\t\t{ urlInputUIContent }\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) }\n\t\t\t\t</>\n\t\t\t) }\n\t\t/>\n\t);\n};\n\nexport default compose( withNotices )( MediaReplaceFlow );\n"]}