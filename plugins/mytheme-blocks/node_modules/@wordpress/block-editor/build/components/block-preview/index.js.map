{"version":3,"sources":["@wordpress/block-editor/src/components/block-preview/index.js"],"names":["ScaledBlockPreview","blocks","viewportWidth","padding","previewRef","isReady","setIsReady","previewScale","setPreviewScale","x","y","setPosition","timerId","setTimeout","containerElement","current","length","block","previewElement","clientId","containerElementRect","getBoundingClientRect","width","height","left","top","scaledElementRect","scale","offsetX","offsetY","style","marginTop","window","clearTimeout","previewStyles","transform","visibility","BlockPreview","settings","renderedBlocks","state","recompute","triggerRecompute","select","getSettings"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { castArray } from 'lodash';\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { Disabled } from '@wordpress/components';\nimport { withSelect } from '@wordpress/data';\nimport {\n\tuseLayoutEffect,\n\tuseState,\n\tuseRef,\n\tuseReducer,\n\tuseMemo,\n} from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport BlockEditorProvider from '../provider';\nimport BlockList from '../block-list';\nimport { getBlockPreviewContainerDOMNode } from '../../utils/dom';\n\nfunction ScaledBlockPreview( { blocks, viewportWidth, padding = 0 } ) {\n\tconst previewRef = useRef( null );\n\n\tconst [ isReady, setIsReady ] = useState( false );\n\tconst [ previewScale, setPreviewScale ] = useState( 1 );\n\tconst [ { x, y }, setPosition ] = useState( { x: 0, y: 0 } );\n\n\t// Dynamically calculate the scale factor\n\tuseLayoutEffect( () => {\n\t\t// Timer - required to account for async render of `BlockEditorProvider`\n\t\tconst timerId = setTimeout( () => {\n\t\t\tconst containerElement = previewRef.current;\n\t\t\tif ( ! containerElement ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// If we're previewing a single block, scale the preview to fit it.\n\t\t\tif ( blocks.length === 1 ) {\n\t\t\t\tconst block = blocks[ 0 ];\n\t\t\t\tconst previewElement = getBlockPreviewContainerDOMNode(\n\t\t\t\t\tblock.clientId\n\t\t\t\t);\n\t\t\t\tif ( ! previewElement ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet containerElementRect = containerElement.getBoundingClientRect();\n\t\t\t\tcontainerElementRect = {\n\t\t\t\t\twidth: containerElementRect.width - padding * 2,\n\t\t\t\t\theight: containerElementRect.height - padding * 2,\n\t\t\t\t\tleft: containerElementRect.left,\n\t\t\t\t\ttop: containerElementRect.top,\n\t\t\t\t};\n\t\t\t\tconst scaledElementRect = previewElement.getBoundingClientRect();\n\n\t\t\t\tconst scale =\n\t\t\t\t\tcontainerElementRect.width / scaledElementRect.width || 1;\n\t\t\t\tconst offsetX =\n\t\t\t\t\t-( scaledElementRect.left - containerElementRect.left ) *\n\t\t\t\t\t\tscale +\n\t\t\t\t\tpadding;\n\t\t\t\tconst offsetY =\n\t\t\t\t\tcontainerElementRect.height >\n\t\t\t\t\tscaledElementRect.height * scale\n\t\t\t\t\t\t? ( containerElementRect.height -\n\t\t\t\t\t\t\t\tscaledElementRect.height * scale ) /\n\t\t\t\t\t\t\t\t2 +\n\t\t\t\t\t\t  padding\n\t\t\t\t\t\t: 0;\n\n\t\t\t\tsetPreviewScale( scale );\n\t\t\t\tsetPosition( { x: offsetX, y: offsetY } );\n\n\t\t\t\t// Hack: we need  to reset the scaled elements margins\n\t\t\t\tpreviewElement.style.marginTop = '0';\n\t\t\t} else {\n\t\t\t\tconst containerElementRect = containerElement.getBoundingClientRect();\n\t\t\t\tsetPreviewScale( containerElementRect.width / viewportWidth );\n\t\t\t}\n\n\t\t\tsetIsReady( true );\n\t\t}, 100 );\n\n\t\t// Cleanup\n\t\treturn () => {\n\t\t\tif ( timerId ) {\n\t\t\t\twindow.clearTimeout( timerId );\n\t\t\t}\n\t\t};\n\t}, [] );\n\n\tif ( ! blocks || blocks.length === 0 ) {\n\t\treturn null;\n\t}\n\n\tconst previewStyles = {\n\t\ttransform: `scale(${ previewScale })`,\n\t\tvisibility: isReady ? 'visible' : 'hidden',\n\t\tleft: x,\n\t\ttop: y,\n\t\twidth: viewportWidth,\n\t};\n\n\treturn (\n\t\t<div\n\t\t\tref={ previewRef }\n\t\t\tclassName={ classnames(\n\t\t\t\t'block-editor-block-preview__container editor-styles-wrapper',\n\t\t\t\t{\n\t\t\t\t\t'is-ready': isReady,\n\t\t\t\t}\n\t\t\t) }\n\t\t\taria-hidden\n\t\t>\n\t\t\t<Disabled\n\t\t\t\tstyle={ previewStyles }\n\t\t\t\tclassName=\"block-editor-block-preview__content\"\n\t\t\t>\n\t\t\t\t<BlockList />\n\t\t\t</Disabled>\n\t\t</div>\n\t);\n}\n\nexport function BlockPreview( {\n\tblocks,\n\tviewportWidth = 700,\n\tpadding,\n\tsettings,\n} ) {\n\tconst renderedBlocks = useMemo( () => castArray( blocks ), [ blocks ] );\n\tconst [ recompute, triggerRecompute ] = useReducer(\n\t\t( state ) => state + 1,\n\t\t0\n\t);\n\tuseLayoutEffect( triggerRecompute, [ blocks ] );\n\treturn (\n\t\t<BlockEditorProvider value={ renderedBlocks } settings={ settings }>\n\t\t\t{ /*\n\t\t\t * The key prop is used to force recomputing the preview\n\t\t\t * by remounting the component, ScaledBlockPreview is not meant to\n\t\t\t * be rerendered.\n\t\t\t */ }\n\t\t\t<ScaledBlockPreview\n\t\t\t\tkey={ recompute }\n\t\t\t\tblocks={ renderedBlocks }\n\t\t\t\tviewportWidth={ viewportWidth }\n\t\t\t\tpadding={ padding }\n\t\t\t/>\n\t\t</BlockEditorProvider>\n\t);\n}\n\n/**\n * BlockPreview renders a preview of a block or array of blocks.\n *\n * @see https://github.com/WordPress/gutenberg/blob/master/packages/block-editor/src/components/block-preview/README.md\n *\n * @param {Array|Object} blocks A block instance (object) or an array of blocks to be previewed.\n * @param {number} viewportWidth Width of the preview container in pixels. Controls at what size the blocks will be rendered inside the preview. Default: 700.\n * @return {WPComponent} The component to be rendered.\n */\nexport default withSelect( ( select ) => {\n\treturn {\n\t\tsettings: select( 'core/block-editor' ).getSettings(),\n\t};\n} )( BlockPreview );\n"]}