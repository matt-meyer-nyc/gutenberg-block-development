{"version":3,"sources":["@wordpress/block-editor/src/components/url-input/index.js"],"names":["throttle","isFunction","classnames","scrollIntoView","__","sprintf","_n","Component","createRef","UP","DOWN","ENTER","TAB","BaseControl","Button","Spinner","withSpokenMessages","Popover","withInstanceId","withSafeTimeout","compose","withSelect","isURL","stopEventPropagation","event","stopPropagation","URLInput","props","onChange","bind","onKeyDown","selectLink","handleOnClick","bindSuggestionNode","autocompleteRef","inputRef","updateSuggestions","suggestionNodes","isUpdatingSuggestions","state","suggestions","showSuggestions","selectedSuggestion","scrollingIntoView","current","onlyScrollIfNeeded","setTimeout","shouldShowInitialSuggestions","suggestionsRequest","index","ref","__experimentalShowInitialSuggestions","value","length","fetchLinkSuggestions","__experimentalFetchLinkSuggestions","handleURLSuggestions","__experimentalHandleURLSuggestions","isInitialSuggestions","setState","loading","request","then","debouncedSpeak","catch","inputValue","target","disableSuggestions","keyCode","selectionStart","preventDefault","setSelectionRange","suggestion","previousIndex","nextIndex","speak","url","focus","label","instanceId","className","isFullWidth","hasBorder","renderSuggestions","__experimentalRenderSuggestions","placeholder","autoFocus","id","suggestionsListboxId","suggestionOptionIdPrefix","suggestionsListProps","role","buildSuggestionItemProps","tabIndex","undefined","isLoading","handleSuggestionClick","map","title","shouldShowSuggestions","hasValue","select","getSettings"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { throttle, isFunction } from 'lodash';\nimport classnames from 'classnames';\nimport scrollIntoView from 'dom-scroll-into-view';\n\n/**\n * WordPress dependencies\n */\nimport { __, sprintf, _n } from '@wordpress/i18n';\nimport { Component, createRef } from '@wordpress/element';\nimport { UP, DOWN, ENTER, TAB } from '@wordpress/keycodes';\nimport {\n\tBaseControl,\n\tButton,\n\tSpinner,\n\twithSpokenMessages,\n\tPopover,\n} from '@wordpress/components';\nimport { withInstanceId, withSafeTimeout, compose } from '@wordpress/compose';\nimport { withSelect } from '@wordpress/data';\nimport { isURL } from '@wordpress/url';\n\n// Since URLInput is rendered in the context of other inputs, but should be\n// considered a separate modal node, prevent keyboard events from propagating\n// as being considered from the input.\nconst stopEventPropagation = ( event ) => event.stopPropagation();\n\nclass URLInput extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\n\t\tthis.onChange = this.onChange.bind( this );\n\t\tthis.onKeyDown = this.onKeyDown.bind( this );\n\t\tthis.selectLink = this.selectLink.bind( this );\n\t\tthis.handleOnClick = this.handleOnClick.bind( this );\n\t\tthis.bindSuggestionNode = this.bindSuggestionNode.bind( this );\n\t\tthis.autocompleteRef = props.autocompleteRef || createRef();\n\t\tthis.inputRef = createRef();\n\t\tthis.updateSuggestions = throttle(\n\t\t\tthis.updateSuggestions.bind( this ),\n\t\t\t200\n\t\t);\n\n\t\tthis.suggestionNodes = [];\n\n\t\tthis.isUpdatingSuggestions = false;\n\n\t\tthis.state = {\n\t\t\tsuggestions: [],\n\t\t\tshowSuggestions: false,\n\t\t\tselectedSuggestion: null,\n\t\t};\n\t}\n\n\tcomponentDidUpdate() {\n\t\tconst { showSuggestions, selectedSuggestion } = this.state;\n\n\t\t// only have to worry about scrolling selected suggestion into view\n\t\t// when already expanded\n\t\tif (\n\t\t\tshowSuggestions &&\n\t\t\tselectedSuggestion !== null &&\n\t\t\t! this.scrollingIntoView\n\t\t) {\n\t\t\tthis.scrollingIntoView = true;\n\n\t\t\tscrollIntoView(\n\t\t\t\tthis.suggestionNodes[ selectedSuggestion ],\n\t\t\t\tthis.autocompleteRef.current,\n\t\t\t\t{\n\t\t\t\t\tonlyScrollIfNeeded: true,\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tthis.props.setTimeout( () => {\n\t\t\t\tthis.scrollingIntoView = false;\n\t\t\t}, 100 );\n\t\t}\n\n\t\tif ( this.shouldShowInitialSuggestions() ) {\n\t\t\tthis.updateSuggestions();\n\t\t}\n\t}\n\n\tcomponentDidMount() {\n\t\tif ( this.shouldShowInitialSuggestions() ) {\n\t\t\tthis.updateSuggestions();\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tdelete this.suggestionsRequest;\n\t}\n\n\tbindSuggestionNode( index ) {\n\t\treturn ( ref ) => {\n\t\t\tthis.suggestionNodes[ index ] = ref;\n\t\t};\n\t}\n\n\tshouldShowInitialSuggestions() {\n\t\tconst { suggestions } = this.state;\n\t\tconst {\n\t\t\t__experimentalShowInitialSuggestions = false,\n\t\t\tvalue,\n\t\t} = this.props;\n\t\treturn (\n\t\t\t! this.isUpdatingSuggestions &&\n\t\t\t__experimentalShowInitialSuggestions &&\n\t\t\t! ( value && value.length ) &&\n\t\t\t! ( suggestions && suggestions.length )\n\t\t);\n\t}\n\n\tupdateSuggestions( value = '' ) {\n\t\tconst {\n\t\t\t__experimentalFetchLinkSuggestions: fetchLinkSuggestions,\n\t\t\t__experimentalHandleURLSuggestions: handleURLSuggestions,\n\t\t} = this.props;\n\n\t\tif ( ! fetchLinkSuggestions ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isInitialSuggestions = ! ( value && value.length );\n\n\t\t// Allow a suggestions request if:\n\t\t// - there are at least 2 characters in the search input (except manual searches where\n\t\t//   search input length is not required to trigger a fetch)\n\t\t// - this is a direct entry (eg: a URL)\n\t\tif (\n\t\t\t! isInitialSuggestions &&\n\t\t\t( value.length < 2 || ( ! handleURLSuggestions && isURL( value ) ) )\n\t\t) {\n\t\t\tthis.setState( {\n\t\t\t\tshowSuggestions: false,\n\t\t\t\tselectedSuggestion: null,\n\t\t\t\tloading: false,\n\t\t\t} );\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isUpdatingSuggestions = true;\n\n\t\tthis.setState( {\n\t\t\tshowSuggestions: true,\n\t\t\tselectedSuggestion: null,\n\t\t\tloading: true,\n\t\t} );\n\n\t\tconst request = fetchLinkSuggestions( value, {\n\t\t\tisInitialSuggestions,\n\t\t} );\n\n\t\trequest\n\t\t\t.then( ( suggestions ) => {\n\t\t\t\t// A fetch Promise doesn't have an abort option. It's mimicked by\n\t\t\t\t// comparing the request reference in on the instance, which is\n\t\t\t\t// reset or deleted on subsequent requests or unmounting.\n\t\t\t\tif ( this.suggestionsRequest !== request ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.setState( {\n\t\t\t\t\tsuggestions,\n\t\t\t\t\tloading: false,\n\t\t\t\t} );\n\n\t\t\t\tif ( !! suggestions.length ) {\n\t\t\t\t\tthis.props.debouncedSpeak(\n\t\t\t\t\t\tsprintf(\n\t\t\t\t\t\t\t_n(\n\t\t\t\t\t\t\t\t'%d result found, use up and down arrow keys to navigate.',\n\t\t\t\t\t\t\t\t'%d results found, use up and down arrow keys to navigate.',\n\t\t\t\t\t\t\t\tsuggestions.length\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tsuggestions.length\n\t\t\t\t\t\t),\n\t\t\t\t\t\t'assertive'\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tthis.props.debouncedSpeak(\n\t\t\t\t\t\t__( 'No results.' ),\n\t\t\t\t\t\t'assertive'\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tthis.isUpdatingSuggestions = false;\n\t\t\t} )\n\t\t\t.catch( () => {\n\t\t\t\tif ( this.suggestionsRequest === request ) {\n\t\t\t\t\tthis.setState( {\n\t\t\t\t\t\tloading: false,\n\t\t\t\t\t} );\n\t\t\t\t\tthis.isUpdatingSuggestions = false;\n\t\t\t\t}\n\t\t\t} );\n\n\t\t// Note that this assignment is handled *before* the async search request\n\t\t// as a Promise always resolves on the next tick of the event loop.\n\t\tthis.suggestionsRequest = request;\n\t}\n\n\tonChange( event ) {\n\t\tconst inputValue = event.target.value;\n\n\t\tthis.props.onChange( inputValue );\n\t\tif ( ! this.props.disableSuggestions ) {\n\t\t\tthis.updateSuggestions( inputValue );\n\t\t}\n\t}\n\n\tonKeyDown( event ) {\n\t\tconst {\n\t\t\tshowSuggestions,\n\t\t\tselectedSuggestion,\n\t\t\tsuggestions,\n\t\t\tloading,\n\t\t} = this.state;\n\n\t\t// If the suggestions are not shown or loading, we shouldn't handle the arrow keys\n\t\t// We shouldn't preventDefault to allow block arrow keys navigation\n\t\tif ( ! showSuggestions || ! suggestions.length || loading ) {\n\t\t\t// In the Windows version of Firefox the up and down arrows don't move the caret\n\t\t\t// within an input field like they do for Mac Firefox/Chrome/Safari. This causes\n\t\t\t// a form of focus trapping that is disruptive to the user experience. This disruption\n\t\t\t// only happens if the caret is not in the first or last position in the text input.\n\t\t\t// See: https://github.com/WordPress/gutenberg/issues/5693#issuecomment-436684747\n\t\t\tswitch ( event.keyCode ) {\n\t\t\t\t// When UP is pressed, if the caret is at the start of the text, move it to the 0\n\t\t\t\t// position.\n\t\t\t\tcase UP: {\n\t\t\t\t\tif ( 0 !== event.target.selectionStart ) {\n\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t\t\t// Set the input caret to position 0\n\t\t\t\t\t\tevent.target.setSelectionRange( 0, 0 );\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t// When DOWN is pressed, if the caret is not at the end of the text, move it to the\n\t\t\t\t// last position.\n\t\t\t\tcase DOWN: {\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.props.value.length !== event.target.selectionStart\n\t\t\t\t\t) {\n\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t\t\t// Set the input caret to the last position\n\t\t\t\t\t\tevent.target.setSelectionRange(\n\t\t\t\t\t\t\tthis.props.value.length,\n\t\t\t\t\t\t\tthis.props.value.length\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst suggestion = this.state.suggestions[\n\t\t\tthis.state.selectedSuggestion\n\t\t];\n\n\t\tswitch ( event.keyCode ) {\n\t\t\tcase UP: {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tevent.preventDefault();\n\t\t\t\tconst previousIndex = ! selectedSuggestion\n\t\t\t\t\t? suggestions.length - 1\n\t\t\t\t\t: selectedSuggestion - 1;\n\t\t\t\tthis.setState( {\n\t\t\t\t\tselectedSuggestion: previousIndex,\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase DOWN: {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tevent.preventDefault();\n\t\t\t\tconst nextIndex =\n\t\t\t\t\tselectedSuggestion === null ||\n\t\t\t\t\tselectedSuggestion === suggestions.length - 1\n\t\t\t\t\t\t? 0\n\t\t\t\t\t\t: selectedSuggestion + 1;\n\t\t\t\tthis.setState( {\n\t\t\t\t\tselectedSuggestion: nextIndex,\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase TAB: {\n\t\t\t\tif ( this.state.selectedSuggestion !== null ) {\n\t\t\t\t\tthis.selectLink( suggestion );\n\t\t\t\t\t// Announce a link has been selected when tabbing away from the input field.\n\t\t\t\t\tthis.props.speak( __( 'Link selected.' ) );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ENTER: {\n\t\t\t\tif ( this.state.selectedSuggestion !== null ) {\n\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\tthis.selectLink( suggestion );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tselectLink( suggestion ) {\n\t\tthis.props.onChange( suggestion.url, suggestion );\n\t\tthis.setState( {\n\t\t\tselectedSuggestion: null,\n\t\t\tshowSuggestions: false,\n\t\t} );\n\t}\n\n\thandleOnClick( suggestion ) {\n\t\tthis.selectLink( suggestion );\n\t\t// Move focus to the input field when a link suggestion is clicked.\n\t\tthis.inputRef.current.focus();\n\t}\n\n\tstatic getDerivedStateFromProps(\n\t\t{\n\t\t\tvalue,\n\t\t\tdisableSuggestions,\n\t\t\t__experimentalShowInitialSuggestions = false,\n\t\t},\n\t\t{ showSuggestions }\n\t) {\n\t\tlet shouldShowSuggestions = showSuggestions;\n\n\t\tconst hasValue = value && value.length;\n\n\t\tif ( ! __experimentalShowInitialSuggestions && ! hasValue ) {\n\t\t\tshouldShowSuggestions = false;\n\t\t}\n\n\t\tif ( disableSuggestions === true ) {\n\t\t\tshouldShowSuggestions = false;\n\t\t}\n\n\t\treturn {\n\t\t\tshowSuggestions: shouldShowSuggestions,\n\t\t};\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tlabel,\n\t\t\tinstanceId,\n\t\t\tclassName,\n\t\t\tisFullWidth,\n\t\t\thasBorder,\n\t\t\t__experimentalRenderSuggestions: renderSuggestions,\n\t\t\tplaceholder = __( 'Paste URL or type to search' ),\n\t\t\tvalue = '',\n\t\t\tautoFocus = true,\n\t\t\t__experimentalShowInitialSuggestions = false,\n\t\t} = this.props;\n\n\t\tconst {\n\t\t\tshowSuggestions,\n\t\t\tsuggestions,\n\t\t\tselectedSuggestion,\n\t\t\tloading,\n\t\t} = this.state;\n\n\t\tconst id = `url-input-control-${ instanceId }`;\n\n\t\tconst suggestionsListboxId = `block-editor-url-input-suggestions-${ instanceId }`;\n\t\tconst suggestionOptionIdPrefix = `block-editor-url-input-suggestion-${ instanceId }`;\n\n\t\tconst suggestionsListProps = {\n\t\t\tid: suggestionsListboxId,\n\t\t\tref: this.autocompleteRef,\n\t\t\trole: 'listbox',\n\t\t};\n\n\t\tconst buildSuggestionItemProps = ( suggestion, index ) => {\n\t\t\treturn {\n\t\t\t\trole: 'option',\n\t\t\t\ttabIndex: '-1',\n\t\t\t\tid: `${ suggestionOptionIdPrefix }-${ index }`,\n\t\t\t\tref: this.bindSuggestionNode( index ),\n\t\t\t\t'aria-selected': index === selectedSuggestion,\n\t\t\t};\n\t\t};\n\n\t\t/* eslint-disable jsx-a11y/no-autofocus */\n\t\treturn (\n\t\t\t<BaseControl\n\t\t\t\tlabel={ label }\n\t\t\t\tid={ id }\n\t\t\t\tclassName={ classnames( 'block-editor-url-input', className, {\n\t\t\t\t\t'is-full-width': isFullWidth,\n\t\t\t\t\t'has-border': hasBorder,\n\t\t\t\t} ) }\n\t\t\t>\n\t\t\t\t<input\n\t\t\t\t\tautoFocus={ autoFocus }\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\taria-label={ __( 'URL' ) }\n\t\t\t\t\trequired\n\t\t\t\t\tvalue={ value }\n\t\t\t\t\tonChange={ this.onChange }\n\t\t\t\t\tonInput={ stopEventPropagation }\n\t\t\t\t\tplaceholder={ placeholder }\n\t\t\t\t\tonKeyDown={ this.onKeyDown }\n\t\t\t\t\trole=\"combobox\"\n\t\t\t\t\taria-expanded={ showSuggestions }\n\t\t\t\t\taria-autocomplete=\"list\"\n\t\t\t\t\taria-owns={ suggestionsListboxId }\n\t\t\t\t\taria-activedescendant={\n\t\t\t\t\t\tselectedSuggestion !== null\n\t\t\t\t\t\t\t? `${ suggestionOptionIdPrefix }-${ selectedSuggestion }`\n\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t}\n\t\t\t\t\tref={ this.inputRef }\n\t\t\t\t/>\n\n\t\t\t\t{ loading && <Spinner /> }\n\n\t\t\t\t{ isFunction( renderSuggestions ) &&\n\t\t\t\t\tshowSuggestions &&\n\t\t\t\t\t!! suggestions.length &&\n\t\t\t\t\trenderSuggestions( {\n\t\t\t\t\t\tsuggestions,\n\t\t\t\t\t\tselectedSuggestion,\n\t\t\t\t\t\tsuggestionsListProps,\n\t\t\t\t\t\tbuildSuggestionItemProps,\n\t\t\t\t\t\tisLoading: loading,\n\t\t\t\t\t\thandleSuggestionClick: this.handleOnClick,\n\t\t\t\t\t\tisInitialSuggestions:\n\t\t\t\t\t\t\t__experimentalShowInitialSuggestions &&\n\t\t\t\t\t\t\t! ( value && value.length ),\n\t\t\t\t\t} ) }\n\n\t\t\t\t{ ! isFunction( renderSuggestions ) &&\n\t\t\t\t\tshowSuggestions &&\n\t\t\t\t\t!! suggestions.length && (\n\t\t\t\t\t\t<Popover\n\t\t\t\t\t\t\tposition=\"bottom\"\n\t\t\t\t\t\t\tnoArrow\n\t\t\t\t\t\t\tfocusOnMount={ false }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t{ ...suggestionsListProps }\n\t\t\t\t\t\t\t\tclassName={ classnames(\n\t\t\t\t\t\t\t\t\t'block-editor-url-input__suggestions',\n\t\t\t\t\t\t\t\t\t`${ className }__suggestions`\n\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{ suggestions.map( ( suggestion, index ) => (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t{ ...buildSuggestionItemProps(\n\t\t\t\t\t\t\t\t\t\t\tsuggestion,\n\t\t\t\t\t\t\t\t\t\t\tindex\n\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\tkey={ suggestion.id }\n\t\t\t\t\t\t\t\t\t\tclassName={ classnames(\n\t\t\t\t\t\t\t\t\t\t\t'block-editor-url-input__suggestion',\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t'is-selected':\n\t\t\t\t\t\t\t\t\t\t\t\t\tindex ===\n\t\t\t\t\t\t\t\t\t\t\t\t\tselectedSuggestion,\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\tonClick={ () =>\n\t\t\t\t\t\t\t\t\t\t\tthis.handleOnClick( suggestion )\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{ suggestion.title }\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t) ) }\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Popover>\n\t\t\t\t\t) }\n\t\t\t</BaseControl>\n\t\t);\n\t\t/* eslint-enable jsx-a11y/no-autofocus */\n\t}\n}\n\n/**\n * @see https://github.com/WordPress/gutenberg/blob/master/packages/block-editor/src/components/url-input/README.md\n */\nexport default compose(\n\twithSafeTimeout,\n\twithSpokenMessages,\n\twithInstanceId,\n\twithSelect( ( select, props ) => {\n\t\t// If a link suggestions handler is already provided then\n\t\t// bail\n\t\tif ( isFunction( props.__experimentalFetchLinkSuggestions ) ) {\n\t\t\treturn;\n\t\t}\n\t\tconst { getSettings } = select( 'core/block-editor' );\n\t\treturn {\n\t\t\t__experimentalFetchLinkSuggestions: getSettings()\n\t\t\t\t.__experimentalFetchLinkSuggestions,\n\t\t};\n\t} )\n)( URLInput );\n"]}