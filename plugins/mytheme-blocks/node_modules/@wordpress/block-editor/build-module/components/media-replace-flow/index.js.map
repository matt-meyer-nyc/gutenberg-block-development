{"version":3,"sources":["@wordpress/block-editor/src/components/media-replace-flow/index.js"],"names":["useState","createRef","__","speak","FormFileUpload","NavigableMenu","MenuItem","ToolbarGroup","Button","Dropdown","withNotices","LEFT","RIGHT","UP","DOWN","BACKSPACE","ENTER","useSelect","compose","link","upload","MediaUpload","MediaUploadCheck","LinkEditor","LinkViewer","MediaReplaceFlow","mediaURL","mediaId","allowedTypes","accept","onSelect","onSelectURL","onError","name","showURLInput","setShowURLInput","showEditURLInput","setShowEditURLInput","mediaURLValue","setMediaURLValue","mediaUpload","select","getSettings","editMediaButtonRef","stopPropagation","event","stopPropagationRelevantKeys","indexOf","keyCode","selectMedia","media","url","selectURL","newURL","uploadFiles","closeDropdown","files","target","setMedia","filesList","onFileChange","openOnArrowDown","preventDefault","click","urlInputUIContent","current","focus","isOpen","onToggle","onClose","open","openFileDialog"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useState, createRef } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\nimport { speak } from '@wordpress/a11y';\nimport {\n\tFormFileUpload,\n\tNavigableMenu,\n\tMenuItem,\n\tToolbarGroup,\n\tButton,\n\tDropdown,\n\twithNotices,\n} from '@wordpress/components';\nimport { LEFT, RIGHT, UP, DOWN, BACKSPACE, ENTER } from '@wordpress/keycodes';\nimport { useSelect } from '@wordpress/data';\nimport { compose } from '@wordpress/compose';\nimport { link, upload } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport MediaUpload from '../media-upload';\nimport MediaUploadCheck from '../media-upload/check';\nimport LinkEditor from '../url-popover/link-editor';\nimport LinkViewer from '../url-popover/link-viewer';\n\nconst MediaReplaceFlow = ( {\n\tmediaURL,\n\tmediaId,\n\tallowedTypes,\n\taccept,\n\tonSelect,\n\tonSelectURL,\n\tonError,\n\tname = __( 'Replace' ),\n} ) => {\n\tconst [ showURLInput, setShowURLInput ] = useState( false );\n\tconst [ showEditURLInput, setShowEditURLInput ] = useState( false );\n\tconst [ mediaURLValue, setMediaURLValue ] = useState( mediaURL );\n\tconst mediaUpload = useSelect( ( select ) => {\n\t\treturn select( 'core/block-editor' ).getSettings().mediaUpload;\n\t}, [] );\n\tconst editMediaButtonRef = createRef();\n\n\tconst stopPropagation = ( event ) => {\n\t\tevent.stopPropagation();\n\t};\n\n\tconst stopPropagationRelevantKeys = ( event ) => {\n\t\tif (\n\t\t\t[ LEFT, DOWN, RIGHT, UP, BACKSPACE, ENTER ].indexOf(\n\t\t\t\tevent.keyCode\n\t\t\t) > -1\n\t\t) {\n\t\t\t// Stop the key event from propagating up to ObserveTyping.startTypingInTextField.\n\t\t\tevent.stopPropagation();\n\t\t}\n\t};\n\n\tconst selectMedia = ( media ) => {\n\t\tonSelect( media );\n\t\tsetMediaURLValue( media.url );\n\t\tspeak( __( 'The media file has been replaced' ) );\n\t};\n\n\tconst selectURL = ( newURL ) => {\n\t\tonSelectURL( newURL );\n\t\tsetShowEditURLInput( false );\n\t};\n\n\tconst uploadFiles = ( event, closeDropdown ) => {\n\t\tconst files = event.target.files;\n\t\tconst setMedia = ( [ media ] ) => {\n\t\t\tselectMedia( media );\n\t\t\tcloseDropdown();\n\t\t};\n\t\tmediaUpload( {\n\t\t\tallowedTypes,\n\t\t\tfilesList: files,\n\t\t\tonFileChange: setMedia,\n\t\t\tonError,\n\t\t} );\n\t};\n\n\tconst openOnArrowDown = ( event ) => {\n\t\tif ( event.keyCode === DOWN ) {\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t\tevent.target.click();\n\t\t}\n\t};\n\n\tlet urlInputUIContent;\n\tif ( showEditURLInput ) {\n\t\turlInputUIContent = (\n\t\t\t<LinkEditor\n\t\t\t\tonKeyDown={ stopPropagationRelevantKeys }\n\t\t\t\tonKeyPress={ stopPropagation }\n\t\t\t\tvalue={ mediaURLValue }\n\t\t\t\tisFullWidthInput={ true }\n\t\t\t\thasInputBorder={ true }\n\t\t\t\tonChangeInputValue={ ( url ) => setMediaURLValue( url ) }\n\t\t\t\tonSubmit={ ( event ) => {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tselectURL( mediaURLValue );\n\t\t\t\t\teditMediaButtonRef.current.focus();\n\t\t\t\t} }\n\t\t\t/>\n\t\t);\n\t} else {\n\t\turlInputUIContent = (\n\t\t\t<LinkViewer\n\t\t\t\tisFullWidth={ true }\n\t\t\t\tclassName=\"block-editor-media-replace-flow__link-viewer\"\n\t\t\t\turl={ mediaURLValue }\n\t\t\t\tonEditLinkClick={ () =>\n\t\t\t\t\tsetShowEditURLInput( ! showEditURLInput )\n\t\t\t\t}\n\t\t\t/>\n\t\t);\n\t}\n\n\treturn (\n\t\t<Dropdown\n\t\t\tcontentClassName=\"block-editor-media-replace-flow__options\"\n\t\t\trenderToggle={ ( { isOpen, onToggle } ) => (\n\t\t\t\t<ToolbarGroup className=\"media-replace-flow\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\tref={ editMediaButtonRef }\n\t\t\t\t\t\taria-expanded={ isOpen }\n\t\t\t\t\t\tonClick={ onToggle }\n\t\t\t\t\t\tonKeyDown={ openOnArrowDown }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ name }\n\t\t\t\t\t\t<span className=\"block-editor-media-replace-flow__indicator\" />\n\t\t\t\t\t</Button>\n\t\t\t\t</ToolbarGroup>\n\t\t\t) }\n\t\t\trenderContent={ ( { onClose } ) => (\n\t\t\t\t<>\n\t\t\t\t\t<NavigableMenu>\n\t\t\t\t\t\t<MediaUpload\n\t\t\t\t\t\t\tvalue={ mediaId }\n\t\t\t\t\t\t\tonSelect={ ( media ) => selectMedia( media ) }\n\t\t\t\t\t\t\tallowedTypes={ allowedTypes }\n\t\t\t\t\t\t\trender={ ( { open } ) => (\n\t\t\t\t\t\t\t\t<MenuItem icon=\"admin-media\" onClick={ open }>\n\t\t\t\t\t\t\t\t\t{ __( 'Open Media Library' ) }\n\t\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<MediaUploadCheck>\n\t\t\t\t\t\t\t<FormFileUpload\n\t\t\t\t\t\t\t\tonChange={ ( event ) => {\n\t\t\t\t\t\t\t\t\tuploadFiles( event, onClose );\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\taccept={ accept }\n\t\t\t\t\t\t\t\trender={ ( { openFileDialog } ) => {\n\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\t\t\t\ticon={ upload }\n\t\t\t\t\t\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\t\t\t\t\t\topenFileDialog();\n\t\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{ __( 'Upload' ) }\n\t\t\t\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</MediaUploadCheck>\n\t\t\t\t\t\t{ onSelectURL && (\n\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\ticon={ link }\n\t\t\t\t\t\t\t\tonClick={ () =>\n\t\t\t\t\t\t\t\t\tsetShowURLInput( ! showURLInput )\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\taria-expanded={ showURLInput }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div> { __( 'Insert from URL' ) } </div>\n\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</NavigableMenu>\n\t\t\t\t\t{ showURLInput && (\n\t\t\t\t\t\t<div className=\"block-editor-media-flow__url-input\">\n\t\t\t\t\t\t\t{ urlInputUIContent }\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) }\n\t\t\t\t</>\n\t\t\t) }\n\t\t/>\n\t);\n};\n\nexport default compose( withNotices )( MediaReplaceFlow );\n"]}