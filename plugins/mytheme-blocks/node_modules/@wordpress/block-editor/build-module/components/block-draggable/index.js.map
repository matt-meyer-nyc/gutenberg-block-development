{"version":3,"sources":["@wordpress/block-editor/src/components/block-draggable/index.js"],"names":["castArray","Draggable","useSelect","useDispatch","useEffect","useRef","BlockDraggable","children","clientIds","select","getBlockIndex","getBlockRootClientId","getTemplateLock","normalizedClientIds","rootClientId","length","templateLock","index","srcRootClientId","isDraggable","isDragging","startDraggingBlocks","stopDraggingBlocks","current","blockElementId","transferData","type","srcIndex","srcClientId","onDraggableStart","onDraggableEnd"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { castArray } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Draggable } from '@wordpress/components';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { useEffect, useRef } from '@wordpress/element';\n\nconst BlockDraggable = ( { children, clientIds } ) => {\n\tconst { srcRootClientId, index, isDraggable } = useSelect(\n\t\t( select ) => {\n\t\t\tconst {\n\t\t\t\tgetBlockIndex,\n\t\t\t\tgetBlockRootClientId,\n\t\t\t\tgetTemplateLock,\n\t\t\t} = select( 'core/block-editor' );\n\t\t\tconst normalizedClientIds = castArray( clientIds );\n\t\t\tconst rootClientId =\n\t\t\t\tnormalizedClientIds.length === 1\n\t\t\t\t\t? getBlockRootClientId( normalizedClientIds[ 0 ] )\n\t\t\t\t\t: null;\n\t\t\tconst templateLock = rootClientId\n\t\t\t\t? getTemplateLock( rootClientId )\n\t\t\t\t: null;\n\n\t\t\treturn {\n\t\t\t\tindex: getBlockIndex( normalizedClientIds[ 0 ], rootClientId ),\n\t\t\t\tsrcRootClientId: rootClientId,\n\t\t\t\tisDraggable:\n\t\t\t\t\tnormalizedClientIds.length === 1 && 'all' !== templateLock,\n\t\t\t};\n\t\t},\n\t\t[ clientIds ]\n\t);\n\tconst isDragging = useRef( false );\n\tconst { startDraggingBlocks, stopDraggingBlocks } = useDispatch(\n\t\t'core/block-editor'\n\t);\n\n\t// Stop dragging blocks if the block draggable is unmounted\n\tuseEffect( () => {\n\t\treturn () => {\n\t\t\tif ( isDragging.current ) {\n\t\t\t\tstopDraggingBlocks();\n\t\t\t}\n\t\t};\n\t}, [] );\n\n\tif ( ! isDraggable ) {\n\t\treturn null;\n\t}\n\n\tconst normalizedClientIds = castArray( clientIds );\n\tconst blockElementId = `block-${ normalizedClientIds[ 0 ] }`;\n\tconst transferData = {\n\t\ttype: 'block',\n\t\tsrcIndex: index,\n\t\tsrcClientId: normalizedClientIds[ 0 ],\n\t\tsrcRootClientId,\n\t};\n\n\treturn (\n\t\t<Draggable\n\t\t\telementId={ blockElementId }\n\t\t\ttransferData={ transferData }\n\t\t\tonDragStart={ () => {\n\t\t\t\tstartDraggingBlocks();\n\t\t\t\tisDragging.current = true;\n\t\t\t} }\n\t\t\tonDragEnd={ () => {\n\t\t\t\tstopDraggingBlocks();\n\t\t\t\tisDragging.current = false;\n\t\t\t} }\n\t\t>\n\t\t\t{ ( { onDraggableStart, onDraggableEnd } ) => {\n\t\t\t\treturn children( {\n\t\t\t\t\tonDraggableStart,\n\t\t\t\t\tonDraggableEnd,\n\t\t\t\t} );\n\t\t\t} }\n\t\t</Draggable>\n\t);\n};\n\nexport default BlockDraggable;\n"]}