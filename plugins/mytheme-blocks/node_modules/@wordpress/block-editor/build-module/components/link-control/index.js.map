{"version":3,"sources":["@wordpress/block-editor/src/components/link-control/index.js"],"names":["classnames","noop","startsWith","Button","ExternalLink","VisuallyHidden","__","sprintf","useRef","useCallback","useState","Fragment","useEffect","safeDecodeURI","filterURLForDisplay","isURL","prependHTTP","getProtocol","useInstanceId","useSelect","focus","LinkControlSettingsDrawer","LinkControlSearchItem","LinkControlSearchInput","LinkControl","value","settings","onChange","showInitialSuggestions","forceIsEditingLink","wrapperNode","instanceId","url","inputValue","setInputValue","undefined","isEditingLink","setIsEditingLink","isEndingEditWithFocus","select","getSettings","fetchSearchSuggestions","__experimentalFetchLinkSuggestions","displayURL","hadFocusLoss","current","contains","document","activeElement","nextFocusTarget","focusable","find","onInputChange","val","handleDirectEntry","type","protocol","includes","Promise","resolve","id","title","handleEntitySearch","args","all","isInitialSuggestions","perPage","results","couldBeURL","concat","stopEditing","getSearchHandler","isInternal","handleManualEntry","renderSearchResults","suggestionsListProps","buildSuggestionItemProps","suggestions","selectedSuggestion","isLoading","resultsListClasses","manualLinkEntryTypes","searchResultsLabelId","labelText","ariaLabel","SearchResultsLabel","map","suggestion","index","toLowerCase"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\nimport { noop, startsWith } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Button, ExternalLink, VisuallyHidden } from '@wordpress/components';\nimport { __, sprintf } from '@wordpress/i18n';\nimport {\n\tuseRef,\n\tuseCallback,\n\tuseState,\n\tFragment,\n\tuseEffect,\n} from '@wordpress/element';\nimport {\n\tsafeDecodeURI,\n\tfilterURLForDisplay,\n\tisURL,\n\tprependHTTP,\n\tgetProtocol,\n} from '@wordpress/url';\nimport { useInstanceId } from '@wordpress/compose';\nimport { useSelect } from '@wordpress/data';\nimport { focus } from '@wordpress/dom';\n\n/**\n * Internal dependencies\n */\nimport LinkControlSettingsDrawer from './settings-drawer';\nimport LinkControlSearchItem from './search-item';\nimport LinkControlSearchInput from './search-input';\n\n/**\n * Default properties associated with a link control value.\n *\n * @typedef WPLinkControlDefaultValue\n *\n * @property {string}   url           Link URL.\n * @property {string=}  title         Link title.\n * @property {boolean=} opensInNewTab Whether link should open in a new browser\n *                                    tab. This value is only assigned if not\n *                                    providing a custom `settings` prop.\n */\n\n/**\n * Custom settings values associated with a link.\n *\n * @typedef {{[setting:string]:any}} WPLinkControlSettingsValue\n */\n\n/**\n * Custom settings values associated with a link.\n *\n * @typedef WPLinkControlSetting\n *\n * @property {string} id    Identifier to use as property for setting value.\n * @property {string} title Human-readable label to show in user interface.\n */\n\n/**\n * Properties associated with a link control value, composed as a union of the\n * default properties and any custom settings values.\n *\n * @typedef {WPLinkControlDefaultValue&WPLinkControlSettingsValue} WPLinkControlValue\n */\n\n/** @typedef {(nextValue:WPLinkControlValue)=>void} WPLinkControlOnChangeProp */\n\n/**\n * @typedef WPLinkControlProps\n *\n * @property {(WPLinkControlSetting[])=}  settings               An array of settings objects. Each object will used to\n *                                                               render a `ToggleControl` for that setting.\n * @property {boolean=}                   forceIsEditingLink     If passed as either `true` or `false`, controls the\n *                                                               internal editing state of the component to respective\n *                                                               show or not show the URL input field.\n * @property {WPLinkControlValue=}        value                  Current link value.\n * @property {WPLinkControlOnChangeProp=} onChange               Value change handler, called with the updated value if\n *                                                               the user selects a new link or updates settings.\n * @property {boolean=}                   showInitialSuggestions Whether to present initial suggestions immediately.\n */\n\n/**\n * Renders a link control. A link control is a controlled input which maintains\n * a value associated with a link (HTML anchor element) and relevant settings\n * for how that link is expected to behave.\n *\n * @param {WPLinkControlProps} props Component props.\n */\nfunction LinkControl( {\n\tvalue,\n\tsettings,\n\tonChange = noop,\n\tshowInitialSuggestions,\n\tforceIsEditingLink,\n} ) {\n\tconst wrapperNode = useRef();\n\tconst instanceId = useInstanceId( LinkControl );\n\tconst [ inputValue, setInputValue ] = useState(\n\t\t( value && value.url ) || ''\n\t);\n\tconst [ isEditingLink, setIsEditingLink ] = useState(\n\t\tforceIsEditingLink !== undefined\n\t\t\t? forceIsEditingLink\n\t\t\t: ! value || ! value.url\n\t);\n\tconst isEndingEditWithFocus = useRef( false );\n\tconst { fetchSearchSuggestions } = useSelect( ( select ) => {\n\t\tconst { getSettings } = select( 'core/block-editor' );\n\t\treturn {\n\t\t\tfetchSearchSuggestions: getSettings()\n\t\t\t\t.__experimentalFetchLinkSuggestions,\n\t\t};\n\t}, [] );\n\tconst displayURL =\n\t\t( value && filterURLForDisplay( safeDecodeURI( value.url ) ) ) || '';\n\n\tuseEffect( () => {\n\t\tif (\n\t\t\tforceIsEditingLink !== undefined &&\n\t\t\tforceIsEditingLink !== isEditingLink\n\t\t) {\n\t\t\tsetIsEditingLink( forceIsEditingLink );\n\t\t}\n\t}, [ forceIsEditingLink ] );\n\n\tuseEffect( () => {\n\t\t// When `isEditingLink` is set to `false`, a focus loss could occur\n\t\t// since the link input may be removed from the DOM. To avoid this,\n\t\t// reinstate focus to a suitable target if focus has in-fact been lost.\n\t\t// Note that the check is necessary because while typically unsetting\n\t\t// edit mode would render the read-only mode's link element, it isn't\n\t\t// guaranteed. The link input may continue to be shown if the next value\n\t\t// is still unassigned after calling `onChange`.\n\t\tconst hadFocusLoss =\n\t\t\tisEndingEditWithFocus.current &&\n\t\t\twrapperNode.current &&\n\t\t\t! wrapperNode.current.contains( document.activeElement );\n\n\t\tif ( hadFocusLoss ) {\n\t\t\t// Prefer to focus a natural focusable descendent of the wrapper,\n\t\t\t// but settle for the wrapper if there are no other options.\n\t\t\tconst nextFocusTarget =\n\t\t\t\tfocus.focusable.find( wrapperNode.current )[ 0 ] ||\n\t\t\t\twrapperNode.current;\n\n\t\t\tnextFocusTarget.focus();\n\t\t}\n\n\t\tisEndingEditWithFocus.current = false;\n\t}, [ isEditingLink ] );\n\n\t/**\n\t * onChange LinkControlSearchInput event handler\n\t *\n\t * @param {string} val Current value returned by the search.\n\t */\n\tconst onInputChange = ( val = '' ) => {\n\t\tsetInputValue( val );\n\t};\n\n\tconst handleDirectEntry = ( val ) => {\n\t\tlet type = 'URL';\n\n\t\tconst protocol = getProtocol( val ) || '';\n\n\t\tif ( protocol.includes( 'mailto' ) ) {\n\t\t\ttype = 'mailto';\n\t\t}\n\n\t\tif ( protocol.includes( 'tel' ) ) {\n\t\t\ttype = 'tel';\n\t\t}\n\n\t\tif ( startsWith( val, '#' ) ) {\n\t\t\ttype = 'internal';\n\t\t}\n\n\t\treturn Promise.resolve( [\n\t\t\t{\n\t\t\t\tid: '-1',\n\t\t\t\ttitle: val,\n\t\t\t\turl: type === 'URL' ? prependHTTP( val ) : val,\n\t\t\t\ttype,\n\t\t\t},\n\t\t] );\n\t};\n\n\tconst handleEntitySearch = async ( val, args ) => {\n\t\tconst results = await Promise.all( [\n\t\t\tfetchSearchSuggestions( val, {\n\t\t\t\t...( args.isInitialSuggestions ? { perPage: 3 } : {} ),\n\t\t\t} ),\n\t\t\thandleDirectEntry( val ),\n\t\t] );\n\n\t\tconst couldBeURL = ! val.includes( ' ' );\n\n\t\t// If it's potentially a URL search then concat on a URL search suggestion\n\t\t// just for good measure. That way once the actual results run out we always\n\t\t// have a URL option to fallback on.\n\t\treturn couldBeURL && ! args.isInitialSuggestions\n\t\t\t? results[ 0 ].concat( results[ 1 ] )\n\t\t\t: results[ 0 ];\n\t};\n\n\t/**\n\t * Cancels editing state and marks that focus may need to be restored after\n\t * the next render, if focus was within the wrapper when editing finished.\n\t */\n\tfunction stopEditing() {\n\t\tisEndingEditWithFocus.current =\n\t\t\t!! wrapperNode.current &&\n\t\t\twrapperNode.current.contains( document.activeElement );\n\n\t\tsetIsEditingLink( false );\n\t}\n\n\t// Effects\n\tconst getSearchHandler = useCallback(\n\t\t( val, args ) => {\n\t\t\tconst isInternal = startsWith( val, '#' );\n\n\t\t\tconst handleManualEntry =\n\t\t\t\tisInternal || isURL( val ) || ( val && val.includes( 'www.' ) );\n\n\t\t\treturn handleManualEntry\n\t\t\t\t? handleDirectEntry( val, args )\n\t\t\t\t: handleEntitySearch( val, args );\n\t\t},\n\t\t[ handleDirectEntry, fetchSearchSuggestions ]\n\t);\n\n\t// Render Components\n\tconst renderSearchResults = ( {\n\t\tsuggestionsListProps,\n\t\tbuildSuggestionItemProps,\n\t\tsuggestions,\n\t\tselectedSuggestion,\n\t\tisLoading,\n\t\tisInitialSuggestions,\n\t} ) => {\n\t\tconst resultsListClasses = classnames(\n\t\t\t'block-editor-link-control__search-results',\n\t\t\t{\n\t\t\t\t'is-loading': isLoading,\n\t\t\t}\n\t\t);\n\n\t\tconst manualLinkEntryTypes = [ 'url', 'mailto', 'tel', 'internal' ];\n\t\tconst searchResultsLabelId = isInitialSuggestions\n\t\t\t? `block-editor-link-control-search-results-label-${ instanceId }`\n\t\t\t: undefined;\n\t\tconst labelText = isInitialSuggestions\n\t\t\t? __( 'Recently updated' )\n\t\t\t: sprintf( __( 'Search results for %s' ), inputValue );\n\t\t// According to guidelines aria-label should be added if the label\n\t\t// itself is not visible.\n\t\t// See: https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Roles/listbox_role\n\t\tconst ariaLabel = isInitialSuggestions ? undefined : labelText;\n\t\tconst SearchResultsLabel = (\n\t\t\t<span\n\t\t\t\tclassName=\"block-editor-link-control__search-results-label\"\n\t\t\t\tid={ searchResultsLabelId }\n\t\t\t\taria-label={ ariaLabel }\n\t\t\t>\n\t\t\t\t{ labelText }\n\t\t\t</span>\n\t\t);\n\n\t\treturn (\n\t\t\t<div className=\"block-editor-link-control__search-results-wrapper\">\n\t\t\t\t{ isInitialSuggestions ? (\n\t\t\t\t\tSearchResultsLabel\n\t\t\t\t) : (\n\t\t\t\t\t<VisuallyHidden>{ SearchResultsLabel }</VisuallyHidden>\n\t\t\t\t) }\n\n\t\t\t\t<div\n\t\t\t\t\t{ ...suggestionsListProps }\n\t\t\t\t\tclassName={ resultsListClasses }\n\t\t\t\t\taria-labelledby={ searchResultsLabelId }\n\t\t\t\t>\n\t\t\t\t\t{ suggestions.map( ( suggestion, index ) => (\n\t\t\t\t\t\t<LinkControlSearchItem\n\t\t\t\t\t\t\tkey={ `${ suggestion.id }-${ suggestion.type }` }\n\t\t\t\t\t\t\titemProps={ buildSuggestionItemProps(\n\t\t\t\t\t\t\t\tsuggestion,\n\t\t\t\t\t\t\t\tindex\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\tsuggestion={ suggestion }\n\t\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\t\tonChange( { ...value, ...suggestion } );\n\t\t\t\t\t\t\t\tstopEditing();\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\tisSelected={ index === selectedSuggestion }\n\t\t\t\t\t\t\tisURL={ manualLinkEntryTypes.includes(\n\t\t\t\t\t\t\t\tsuggestion.type.toLowerCase()\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\tsearchTerm={ inputValue }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) ) }\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t};\n\n\treturn (\n\t\t<div\n\t\t\ttabIndex={ -1 }\n\t\t\tref={ wrapperNode }\n\t\t\tclassName=\"block-editor-link-control\"\n\t\t>\n\t\t\t{ isEditingLink || ! value ? (\n\t\t\t\t<LinkControlSearchInput\n\t\t\t\t\tvalue={ inputValue }\n\t\t\t\t\tonChange={ onInputChange }\n\t\t\t\t\tonSelect={ ( suggestion ) => {\n\t\t\t\t\t\tonChange( { ...value, ...suggestion } );\n\t\t\t\t\t\tstopEditing();\n\t\t\t\t\t} }\n\t\t\t\t\trenderSuggestions={ renderSearchResults }\n\t\t\t\t\tfetchSuggestions={ getSearchHandler }\n\t\t\t\t\tshowInitialSuggestions={ showInitialSuggestions }\n\t\t\t\t/>\n\t\t\t) : (\n\t\t\t\t<Fragment>\n\t\t\t\t\t<p\n\t\t\t\t\t\tclassName=\"screen-reader-text\"\n\t\t\t\t\t\tid={ `current-link-label-${ instanceId }` }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ __( 'Currently selected' ) }:\n\t\t\t\t\t</p>\n\t\t\t\t\t<div\n\t\t\t\t\t\taria-labelledby={ `current-link-label-${ instanceId }` }\n\t\t\t\t\t\taria-selected=\"true\"\n\t\t\t\t\t\tclassName={ classnames(\n\t\t\t\t\t\t\t'block-editor-link-control__search-item',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t'is-current': true,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t) }\n\t\t\t\t\t>\n\t\t\t\t\t\t<span className=\"block-editor-link-control__search-item-header\">\n\t\t\t\t\t\t\t<ExternalLink\n\t\t\t\t\t\t\t\tclassName=\"block-editor-link-control__search-item-title\"\n\t\t\t\t\t\t\t\thref={ value.url }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{ ( value && value.title ) || displayURL }\n\t\t\t\t\t\t\t</ExternalLink>\n\t\t\t\t\t\t\t{ value && value.title && (\n\t\t\t\t\t\t\t\t<span className=\"block-editor-link-control__search-item-info\">\n\t\t\t\t\t\t\t\t\t{ displayURL }\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t</span>\n\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tisSecondary\n\t\t\t\t\t\t\tonClick={ () => setIsEditingLink( true ) }\n\t\t\t\t\t\t\tclassName=\"block-editor-link-control__search-item-action\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ __( 'Edit' ) }\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</Fragment>\n\t\t\t) }\n\t\t\t<LinkControlSettingsDrawer\n\t\t\t\tvalue={ value }\n\t\t\t\tsettings={ settings }\n\t\t\t\tonChange={ onChange }\n\t\t\t/>\n\t\t</div>\n\t);\n}\n\nexport default LinkControl;\n"]}