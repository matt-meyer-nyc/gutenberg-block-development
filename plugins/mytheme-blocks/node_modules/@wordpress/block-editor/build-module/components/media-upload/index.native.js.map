{"version":3,"sources":["@wordpress/block-editor/src/components/media-upload/index.native.js"],"names":["React","getOtherMediaOptions","requestMediaPicker","mediaSources","__","Picker","MEDIA_TYPE_IMAGE","MEDIA_TYPE_VIDEO","OPTION_TAKE_VIDEO","OPTION_TAKE_PHOTO","OPTION_TAKE_PHOTO_OR_VIDEO","cameraImageSource","id","deviceCamera","value","label","types","icon","cameraVideoSource","deviceLibrarySource","deviceLibrary","siteLibrarySource","siteMediaLibrary","internalSources","MediaUpload","props","onPickerPresent","bind","onPickerSelect","getAllSources","state","otherMediaOptions","allowedTypes","otherMediaOptionsWithIcons","map","option","setState","concat","multiple","__DEV__","includes","filter","source","allowedType","length","getChooseFromDeviceIcon","isOneType","isImage","isVideo","picker","presentPicker","onSelect","mediaSource","shift","type","media","getMediaOptions","instance","getMediaOptionsItems","render","open","Component"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport React from 'react';\nimport {\n\tgetOtherMediaOptions,\n\trequestMediaPicker,\n\tmediaSources,\n} from 'react-native-gutenberg-bridge';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Picker } from '@wordpress/components';\n\nexport const MEDIA_TYPE_IMAGE = 'image';\nexport const MEDIA_TYPE_VIDEO = 'video';\n\nexport const OPTION_TAKE_VIDEO = __( 'Take a Video' );\nexport const OPTION_TAKE_PHOTO = __( 'Take a Photo' );\nexport const OPTION_TAKE_PHOTO_OR_VIDEO = __( 'Take a Photo or Video' );\n\nconst cameraImageSource = {\n\tid: mediaSources.deviceCamera, // ID is the value sent to native\n\tvalue: mediaSources.deviceCamera + '-IMAGE', // This is needed to diferenciate image-camera from video-camera sources.\n\tlabel: __( 'Take a Photo' ),\n\ttypes: [ MEDIA_TYPE_IMAGE ],\n\ticon: 'camera',\n};\n\nconst cameraVideoSource = {\n\tid: mediaSources.deviceCamera,\n\tvalue: mediaSources.deviceCamera,\n\tlabel: __( 'Take a Video' ),\n\ttypes: [ MEDIA_TYPE_VIDEO ],\n\ticon: 'camera',\n};\n\nconst deviceLibrarySource = {\n\tid: mediaSources.deviceLibrary,\n\tvalue: mediaSources.deviceLibrary,\n\tlabel: __( 'Choose from device' ),\n\ttypes: [ MEDIA_TYPE_IMAGE, MEDIA_TYPE_VIDEO ],\n};\n\nconst siteLibrarySource = {\n\tid: mediaSources.siteMediaLibrary,\n\tvalue: mediaSources.siteMediaLibrary,\n\tlabel: __( 'WordPress Media Library' ),\n\ttypes: [ MEDIA_TYPE_IMAGE, MEDIA_TYPE_VIDEO ],\n\ticon: 'wordpress-alt',\n};\n\nconst internalSources = [\n\tdeviceLibrarySource,\n\tcameraImageSource,\n\tcameraVideoSource,\n\tsiteLibrarySource,\n];\n\nexport class MediaUpload extends React.Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\t\tthis.onPickerPresent = this.onPickerPresent.bind( this );\n\t\tthis.onPickerSelect = this.onPickerSelect.bind( this );\n\t\tthis.getAllSources = this.getAllSources.bind( this );\n\n\t\tthis.state = {\n\t\t\totherMediaOptions: [],\n\t\t};\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { allowedTypes = [] } = this.props;\n\t\tgetOtherMediaOptions( allowedTypes, ( otherMediaOptions ) => {\n\t\t\tconst otherMediaOptionsWithIcons = otherMediaOptions.map(\n\t\t\t\t( option ) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...option,\n\t\t\t\t\t\ttypes: allowedTypes,\n\t\t\t\t\t\tid: option.value,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tthis.setState( { otherMediaOptions: otherMediaOptionsWithIcons } );\n\t\t} );\n\t}\n\n\tgetAllSources() {\n\t\treturn internalSources.concat( this.state.otherMediaOptions );\n\t}\n\n\tgetMediaOptionsItems() {\n\t\tconst { allowedTypes = [], multiple = false } = this.props;\n\n\t\t// disable upload sources for now when multiple flag is set\n\t\t// eslint-disable-next-line no-undef\n\t\tif ( ! __DEV__ ) {\n\t\t\tif ( allowedTypes.includes( MEDIA_TYPE_IMAGE ) && multiple ) {\n\t\t\t\treturn [ siteLibrarySource ];\n\t\t\t}\n\t\t}\n\n\t\treturn this.getAllSources()\n\t\t\t.filter( ( source ) => {\n\t\t\t\treturn (\n\t\t\t\t\tallowedTypes.filter( ( allowedType ) =>\n\t\t\t\t\t\tsource.types.includes( allowedType )\n\t\t\t\t\t).length > 0\n\t\t\t\t);\n\t\t\t} )\n\t\t\t.map( ( source ) => {\n\t\t\t\treturn {\n\t\t\t\t\t...source,\n\t\t\t\t\ticon: source.icon || this.getChooseFromDeviceIcon(),\n\t\t\t\t};\n\t\t\t} );\n\t}\n\n\tgetChooseFromDeviceIcon() {\n\t\tconst { allowedTypes = [] } = this.props;\n\n\t\tconst isOneType = allowedTypes.length === 1;\n\t\tconst isImage = isOneType && allowedTypes.includes( MEDIA_TYPE_IMAGE );\n\t\tconst isVideo = isOneType && allowedTypes.includes( MEDIA_TYPE_VIDEO );\n\n\t\tif ( isImage || ! isOneType ) {\n\t\t\treturn 'format-image';\n\t\t} else if ( isVideo ) {\n\t\t\treturn 'format-video';\n\t\t}\n\t}\n\n\tonPickerPresent() {\n\t\tif ( this.picker ) {\n\t\t\tthis.picker.presentPicker();\n\t\t}\n\t}\n\n\tonPickerSelect( value ) {\n\t\tconst { allowedTypes = [], onSelect, multiple = false } = this.props;\n\t\tconst mediaSource = this.getAllSources()\n\t\t\t.filter( ( source ) => source.value === value )\n\t\t\t.shift();\n\t\tconst types = allowedTypes.filter( ( type ) =>\n\t\t\tmediaSource.types.includes( type )\n\t\t);\n\t\trequestMediaPicker( mediaSource.id, types, multiple, ( media ) => {\n\t\t\tif ( ( multiple && media ) || ( media && media.id ) ) {\n\t\t\t\tonSelect( media );\n\t\t\t}\n\t\t} );\n\t}\n\n\trender() {\n\t\tconst getMediaOptions = () => (\n\t\t\t<Picker\n\t\t\t\thideCancelButton\n\t\t\t\tref={ ( instance ) => ( this.picker = instance ) }\n\t\t\t\toptions={ this.getMediaOptionsItems() }\n\t\t\t\tonChange={ this.onPickerSelect }\n\t\t\t/>\n\t\t);\n\n\t\treturn this.props.render( {\n\t\t\topen: this.onPickerPresent,\n\t\t\tgetMediaOptions,\n\t\t} );\n\t}\n}\n\nexport default MediaUpload;\n"]}