{"version":3,"sources":["@wordpress/block-editor/src/components/block-list/insertion-point.js"],"names":["Indicator","clientId","showInsertionPoint","select","getBlockIndex","getBlockInsertionPoint","isBlockInsertionPointVisible","getBlockRootClientId","rootClientId","blockIndex","insertionPoint","index","InsertionPoint","className","isMultiSelecting","hasMultiSelection","selectedBlockClientId","children","containerRef","isInserterShown","setIsInserterShown","isInserterForced","setIsInserterForced","inserterElement","setInserterElement","inserterClientId","setInserterClientId","ref","getMultiSelectedBlockClientIds","multiSelectedBlockClientIds","onMouseMove","event","target","rect","getBoundingClientRect","offset","clientY","top","element","Array","from","find","blockEl","offsetTop","id","slice","length","elementRect","clientX","right","left","focusClosestTabbable","current","targetRect","isReverse","height","blockNode","container","closest","window","DOMRect","isInserterHidden","includes","width","offsetWidth","undefined"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { useSelect } from '@wordpress/data';\nimport { useState, useRef } from '@wordpress/element';\nimport { Popover } from '@wordpress/components';\nimport { placeCaretAtVerticalEdge } from '@wordpress/dom';\n\n/**\n * Internal dependencies\n */\nimport Inserter from '../inserter';\nimport { getClosestTabbable } from '../writing-flow';\nimport { getBlockDOMNode } from '../../utils/dom';\n\nfunction Indicator( { clientId } ) {\n\tconst showInsertionPoint = useSelect(\n\t\t( select ) => {\n\t\t\tconst {\n\t\t\t\tgetBlockIndex,\n\t\t\t\tgetBlockInsertionPoint,\n\t\t\t\tisBlockInsertionPointVisible,\n\t\t\t\tgetBlockRootClientId,\n\t\t\t} = select( 'core/block-editor' );\n\t\t\tconst rootClientId = getBlockRootClientId( clientId );\n\t\t\tconst blockIndex = getBlockIndex( clientId, rootClientId );\n\t\t\tconst insertionPoint = getBlockInsertionPoint();\n\t\t\treturn (\n\t\t\t\tisBlockInsertionPointVisible() &&\n\t\t\t\tinsertionPoint.index === blockIndex &&\n\t\t\t\tinsertionPoint.rootClientId === rootClientId\n\t\t\t);\n\t\t},\n\t\t[ clientId ]\n\t);\n\n\tif ( ! showInsertionPoint ) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<div className=\"block-editor-block-list__insertion-point-indicator\" />\n\t);\n}\n\nexport default function InsertionPoint( {\n\tclassName,\n\tisMultiSelecting,\n\thasMultiSelection,\n\tselectedBlockClientId,\n\tchildren,\n\tcontainerRef,\n} ) {\n\tconst [ isInserterShown, setIsInserterShown ] = useState( false );\n\tconst [ isInserterForced, setIsInserterForced ] = useState( false );\n\tconst [ inserterElement, setInserterElement ] = useState( null );\n\tconst [ inserterClientId, setInserterClientId ] = useState( null );\n\tconst ref = useRef();\n\tconst { multiSelectedBlockClientIds } = useSelect( ( select ) => {\n\t\tconst { getMultiSelectedBlockClientIds } = select(\n\t\t\t'core/block-editor'\n\t\t);\n\n\t\treturn {\n\t\t\tmultiSelectedBlockClientIds: getMultiSelectedBlockClientIds(),\n\t\t};\n\t} );\n\n\tfunction onMouseMove( event ) {\n\t\tif ( event.target.className !== className ) {\n\t\t\tif ( isInserterShown ) {\n\t\t\t\tsetIsInserterShown( false );\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tconst rect = event.target.getBoundingClientRect();\n\t\tconst offset = event.clientY - rect.top;\n\t\tconst element = Array.from( event.target.children ).find(\n\t\t\t( blockEl ) => {\n\t\t\t\treturn blockEl.offsetTop > offset;\n\t\t\t}\n\t\t);\n\n\t\tif ( ! element ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst clientId = element.id.slice( 'block-'.length );\n\n\t\tif ( ! clientId ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst elementRect = element.getBoundingClientRect();\n\n\t\tif (\n\t\t\tevent.clientX > elementRect.right ||\n\t\t\tevent.clientX < elementRect.left\n\t\t) {\n\t\t\tif ( isInserterShown ) {\n\t\t\t\tsetIsInserterShown( false );\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsInserterShown( true );\n\t\tsetInserterElement( element );\n\t\tsetInserterClientId( clientId );\n\t}\n\n\tfunction focusClosestTabbable( event ) {\n\t\tconst { clientX, clientY, target } = event;\n\n\t\t// Only handle click on the wrapper specifically, and not an event\n\t\t// bubbled from the inserter itself.\n\t\tif ( target !== ref.current ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst targetRect = target.getBoundingClientRect();\n\t\tconst isReverse = clientY < targetRect.top + targetRect.height / 2;\n\t\tconst blockNode = getBlockDOMNode( inserterClientId );\n\t\tconst container = isReverse ? containerRef.current : blockNode;\n\t\tconst closest = getClosestTabbable( blockNode, true, container );\n\t\tconst rect = new window.DOMRect( clientX, clientY, 0, 16 );\n\n\t\tif ( closest ) {\n\t\t\tplaceCaretAtVerticalEdge( closest, isReverse, rect, false );\n\t\t}\n\t}\n\n\t// Hide the inserter above the selected block and during multi-selection.\n\tconst isInserterHidden = hasMultiSelection\n\t\t? multiSelectedBlockClientIds.includes( inserterClientId )\n\t\t: inserterClientId === selectedBlockClientId;\n\n\treturn (\n\t\t<>\n\t\t\t{ ! isMultiSelecting && ( isInserterShown || isInserterForced ) && (\n\t\t\t\t<Popover\n\t\t\t\t\tnoArrow\n\t\t\t\t\tanimate={ false }\n\t\t\t\t\tanchorRef={ inserterElement }\n\t\t\t\t\tposition=\"top right left\"\n\t\t\t\t\tfocusOnMount={ false }\n\t\t\t\t\tclassName=\"block-editor-block-list__insertion-point-popover\"\n\t\t\t\t\t__unstableSlotName=\"block-toolbar\"\n\t\t\t\t\t__unstableFixedPosition={ false }\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName=\"block-editor-block-list__insertion-point\"\n\t\t\t\t\t\tstyle={ { width: inserterElement.offsetWidth } }\n\t\t\t\t\t>\n\t\t\t\t\t\t<Indicator clientId={ inserterClientId } />\n\t\t\t\t\t\t{ /* eslint-disable-next-line jsx-a11y/no-static-element-interactions, jsx-a11y/click-events-have-key-events */ }\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tref={ ref }\n\t\t\t\t\t\t\tonFocus={ () => setIsInserterForced( true ) }\n\t\t\t\t\t\t\tonBlur={ () => setIsInserterForced( false ) }\n\t\t\t\t\t\t\tonClick={ focusClosestTabbable }\n\t\t\t\t\t\t\t// While ideally it would be enough to capture the\n\t\t\t\t\t\t\t// bubbling focus event from the Inserter, due to the\n\t\t\t\t\t\t\t// characteristics of click focusing of `button`s in\n\t\t\t\t\t\t\t// Firefox and Safari, it is not reliable.\n\t\t\t\t\t\t\t//\n\t\t\t\t\t\t\t// See: https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#Clicking_and_focus\n\t\t\t\t\t\t\ttabIndex={ -1 }\n\t\t\t\t\t\t\tclassName={ classnames(\n\t\t\t\t\t\t\t\t'block-editor-block-list__insertion-point-inserter',\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t'is-inserter-hidden': isInserterHidden,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Inserter clientId={ inserterClientId } />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</Popover>\n\t\t\t) }\n\t\t\t<div\n\t\t\t\tonMouseMove={\n\t\t\t\t\t! isInserterForced && ! isMultiSelecting\n\t\t\t\t\t\t? onMouseMove\n\t\t\t\t\t\t: undefined\n\t\t\t\t}\n\t\t\t>\n\t\t\t\t{ children }\n\t\t\t</div>\n\t\t</>\n\t);\n}\n"]}