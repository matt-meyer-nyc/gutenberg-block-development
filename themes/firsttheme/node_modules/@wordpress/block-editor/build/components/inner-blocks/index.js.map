{"version":3,"sources":["@wordpress/block-editor/src/components/inner-blocks/index.js"],"names":["InnerBlocks","arguments","state","templateInProcess","props","template","updateNestedSettings","block","templateLock","__experimentalBlocks","replaceInnerBlocks","__unstableMarkNextChangeAsNotPersistent","innerBlocks","length","synchronizeBlocksWithTemplate","setState","prevProps","isLastBlockChangePersistent","onInput","onChange","hasTemplateChanged","resetFunc","nextBlocks","blockListSettings","allowedBlocks","parentLock","__experimentalCaptureToolbars","__experimentalMoverDirection","__experimentalUIParts","newSettings","undefined","enableClickThrough","clientId","hasOverlay","captureToolbars","classes","Component","isSmallScreen","context","select","ownProps","isBlockSelected","hasSelectedInnerBlock","getBlock","getBlockListSettings","getBlockRootClientId","getTemplateLock","isNavigationMode","rootClientId","name","dispatch","updateBlockListSettings","templateInsertUpdatesSelection","blocks","settings","DefaultBlockAppender","ButtonBlockAppender","Content","BlockContent"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { pick, isEqual } from 'lodash';\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { withViewportMatch } from '@wordpress/viewport';\nimport { Component } from '@wordpress/element';\nimport { withSelect, withDispatch } from '@wordpress/data';\nimport {\n\tsynchronizeBlocksWithTemplate,\n\twithBlockContentContext,\n} from '@wordpress/blocks';\nimport isShallowEqual from '@wordpress/is-shallow-equal';\nimport { compose } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport ButtonBlockAppender from './button-block-appender';\nimport DefaultBlockAppender from './default-block-appender';\n\n/**\n * Internal dependencies\n */\nimport BlockList from '../block-list';\nimport { withBlockEditContext } from '../block-edit/context';\n\nclass InnerBlocks extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\tthis.state = {\n\t\t\ttemplateInProcess: !! this.props.template,\n\t\t};\n\t\tthis.updateNestedSettings();\n\t}\n\n\tcomponentDidMount() {\n\t\tconst {\n\t\t\tblock,\n\t\t\ttemplateLock,\n\t\t\t__experimentalBlocks,\n\t\t\treplaceInnerBlocks,\n\t\t\t__unstableMarkNextChangeAsNotPersistent,\n\t\t} = this.props;\n\t\tconst { innerBlocks } = block;\n\t\t// Only synchronize innerBlocks with template if innerBlocks are empty or a locking all exists directly on the block.\n\t\tif ( innerBlocks.length === 0 || templateLock === 'all' ) {\n\t\t\tthis.synchronizeBlocksWithTemplate();\n\t\t}\n\n\t\tif ( this.state.templateInProcess ) {\n\t\t\tthis.setState( {\n\t\t\t\ttemplateInProcess: false,\n\t\t\t} );\n\t\t}\n\n\t\t// Set controlled blocks value from parent, if any.\n\t\tif ( __experimentalBlocks ) {\n\t\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\t\treplaceInnerBlocks( __experimentalBlocks );\n\t\t}\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst {\n\t\t\tblock,\n\t\t\ttemplateLock,\n\t\t\ttemplate,\n\t\t\tisLastBlockChangePersistent,\n\t\t\tonInput,\n\t\t\tonChange,\n\t\t} = this.props;\n\t\tconst { innerBlocks } = block;\n\n\t\tthis.updateNestedSettings();\n\t\t// Only synchronize innerBlocks with template if innerBlocks are empty or a locking all exists directly on the block.\n\t\tif ( innerBlocks.length === 0 || templateLock === 'all' ) {\n\t\t\tconst hasTemplateChanged = ! isEqual(\n\t\t\t\ttemplate,\n\t\t\t\tprevProps.template\n\t\t\t);\n\t\t\tif ( hasTemplateChanged ) {\n\t\t\t\tthis.synchronizeBlocksWithTemplate();\n\t\t\t}\n\t\t}\n\n\t\t// Sync with controlled blocks value from parent, if possible.\n\t\tif ( prevProps.block.innerBlocks !== innerBlocks ) {\n\t\t\tconst resetFunc = isLastBlockChangePersistent ? onChange : onInput;\n\t\t\tif ( resetFunc ) {\n\t\t\t\tresetFunc( innerBlocks );\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Called on mount or when a mismatch exists between the templates and\n\t * inner blocks, synchronizes inner blocks with the template, replacing\n\t * current blocks.\n\t */\n\tsynchronizeBlocksWithTemplate() {\n\t\tconst { template, block, replaceInnerBlocks } = this.props;\n\t\tconst { innerBlocks } = block;\n\n\t\t// Synchronize with templates. If the next set differs, replace.\n\t\tconst nextBlocks = synchronizeBlocksWithTemplate(\n\t\t\tinnerBlocks,\n\t\t\ttemplate\n\t\t);\n\t\tif ( ! isEqual( nextBlocks, innerBlocks ) ) {\n\t\t\treplaceInnerBlocks( nextBlocks );\n\t\t}\n\t}\n\n\tupdateNestedSettings() {\n\t\tconst {\n\t\t\tblockListSettings,\n\t\t\tallowedBlocks,\n\t\t\tupdateNestedSettings,\n\t\t\ttemplateLock,\n\t\t\tparentLock,\n\t\t\t__experimentalCaptureToolbars,\n\t\t\t__experimentalMoverDirection,\n\t\t\t__experimentalUIParts,\n\t\t} = this.props;\n\n\t\tconst newSettings = {\n\t\t\tallowedBlocks,\n\t\t\ttemplateLock:\n\t\t\t\ttemplateLock === undefined ? parentLock : templateLock,\n\t\t\t__experimentalCaptureToolbars:\n\t\t\t\t__experimentalCaptureToolbars || false,\n\t\t\t__experimentalMoverDirection,\n\t\t\t__experimentalUIParts,\n\t\t};\n\n\t\tif ( ! isShallowEqual( blockListSettings, newSettings ) ) {\n\t\t\tupdateNestedSettings( newSettings );\n\t\t}\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tenableClickThrough,\n\t\t\tclientId,\n\t\t\thasOverlay,\n\t\t\t__experimentalCaptureToolbars: captureToolbars,\n\t\t\t...props\n\t\t} = this.props;\n\t\tconst { templateInProcess } = this.state;\n\n\t\tconst classes = classnames( 'block-editor-inner-blocks', {\n\t\t\t'has-overlay': enableClickThrough && hasOverlay,\n\t\t\t'is-capturing-toolbar': captureToolbars,\n\t\t} );\n\n\t\treturn (\n\t\t\t<div className={ classes }>\n\t\t\t\t{ ! templateInProcess && (\n\t\t\t\t\t<BlockList rootClientId={ clientId } { ...props } />\n\t\t\t\t) }\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nInnerBlocks = compose( [\n\twithViewportMatch( { isSmallScreen: '< medium' } ),\n\twithBlockEditContext( ( context ) => pick( context, [ 'clientId' ] ) ),\n\twithSelect( ( select, ownProps ) => {\n\t\tconst {\n\t\t\tisBlockSelected,\n\t\t\thasSelectedInnerBlock,\n\t\t\tgetBlock,\n\t\t\tgetBlockListSettings,\n\t\t\tgetBlockRootClientId,\n\t\t\tgetTemplateLock,\n\t\t\tisNavigationMode,\n\t\t\tisLastBlockChangePersistent,\n\t\t} = select( 'core/block-editor' );\n\t\tconst { clientId, isSmallScreen } = ownProps;\n\t\tconst block = getBlock( clientId );\n\t\tconst rootClientId = getBlockRootClientId( clientId );\n\n\t\treturn {\n\t\t\tblock,\n\t\t\tblockListSettings: getBlockListSettings( clientId ),\n\t\t\thasOverlay:\n\t\t\t\tblock.name !== 'core/template' &&\n\t\t\t\t! isBlockSelected( clientId ) &&\n\t\t\t\t! hasSelectedInnerBlock( clientId, true ),\n\t\t\tparentLock: getTemplateLock( rootClientId ),\n\t\t\tenableClickThrough: isNavigationMode() || isSmallScreen,\n\t\t\tisLastBlockChangePersistent: isLastBlockChangePersistent(),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch, ownProps ) => {\n\t\tconst {\n\t\t\treplaceInnerBlocks,\n\t\t\t__unstableMarkNextChangeAsNotPersistent,\n\t\t\tupdateBlockListSettings,\n\t\t} = dispatch( 'core/block-editor' );\n\t\tconst {\n\t\t\tblock,\n\t\t\tclientId,\n\t\t\ttemplateInsertUpdatesSelection = true,\n\t\t} = ownProps;\n\n\t\treturn {\n\t\t\treplaceInnerBlocks( blocks ) {\n\t\t\t\treplaceInnerBlocks(\n\t\t\t\t\tclientId,\n\t\t\t\t\tblocks,\n\t\t\t\t\tblock.innerBlocks.length === 0 &&\n\t\t\t\t\t\ttemplateInsertUpdatesSelection &&\n\t\t\t\t\t\tblocks.length !== 0\n\t\t\t\t);\n\t\t\t},\n\t\t\t__unstableMarkNextChangeAsNotPersistent,\n\t\t\tupdateNestedSettings( settings ) {\n\t\t\t\tdispatch( updateBlockListSettings( clientId, settings ) );\n\t\t\t},\n\t\t};\n\t} ),\n] )( InnerBlocks );\n\n// Expose default appender placeholders as components.\nInnerBlocks.DefaultBlockAppender = DefaultBlockAppender;\nInnerBlocks.ButtonBlockAppender = ButtonBlockAppender;\n\nInnerBlocks.Content = withBlockContentContext( ( { BlockContent } ) => (\n\t<BlockContent />\n) );\n\n/**\n * @see https://github.com/WordPress/gutenberg/blob/master/packages/block-editor/src/components/inner-blocks/README.md\n */\nexport default InnerBlocks;\n"]}