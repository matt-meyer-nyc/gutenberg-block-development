{"version":3,"sources":["@wordpress/block-editor/src/components/block-list/block-popover.js"],"names":["findIndex","classnames","useState","useCallback","useContext","isUnmodifiedDefaultBlock","Popover","useSelect","useShortcut","useViewportMatch","BlockBreadcrumb","BlockContextualToolbar","Inserter","BlockNodes","selector","select","isNavigationMode","isMultiSelecting","hasMultiSelection","isTyping","isCaretWithinFormattedText","getSettings","getLastMultiSelectedBlockClientId","hasFixedToolbar","lastClientId","BlockPopover","clientId","rootClientId","name","align","isValid","moverDirection","isEmptyDefaultBlock","capturingClientId","isLargeViewport","isToolbarForced","setIsToolbarForced","isInserterShown","setIsInserterShown","blockNodes","showEmptyBlockSideInserter","shouldShowBreadcrumb","shouldShowContextualToolbar","canFocusHiddenToolbar","bindGlobal","eventName","isDisabled","node","document","getElementById","classList","contains","querySelector","anchorRef","bottomNode","top","bottom","onFocus","onBlur","popoverPosition","wrapperSelector","getSelectedBlockClientId","getFirstMultiSelectedBlockClientId","getBlockRootClientId","__unstableGetBlockWithoutInnerBlocks","getBlockParents","getBlockListSettings","__experimentalGetBlockListSettingsForBlocks","attributes","blockParentsClientIds","__experimentalMoverDirection","ancestorBlockListSettings","topmostAncestorWithCaptureDescendantsToolbarsIndex","WrappedBlockPopover","selected"],"mappings":";;;AAAA;;;AAGA,SAASA,SAAT,QAA0B,QAA1B;AACA,OAAOC,UAAP,MAAuB,YAAvB;AAEA;;;;AAGA,SAASC,QAAT,EAAmBC,WAAnB,EAAgCC,UAAhC,QAAkD,oBAAlD;AACA,SAASC,wBAAT,QAAyC,mBAAzC;AACA,SAASC,OAAT,QAAwB,uBAAxB;AACA,SAASC,SAAT,QAA0B,iBAA1B;AACA,SAASC,WAAT,QAA4B,+BAA5B;AACA,SAASC,gBAAT,QAAiC,oBAAjC;AAEA;;;;AAGA,OAAOC,eAAP,MAA4B,cAA5B;AACA,OAAOC,sBAAP,MAAmC,4BAAnC;AACA,OAAOC,QAAP,MAAqB,aAArB;AACA,SAASC,UAAT,QAA2B,kBAA3B;;AAEA,SAASC,QAAT,CAAmBC,MAAnB,EAA4B;AAAA,gBASvBA,MAAM,CAAE,mBAAF,CATiB;AAAA,MAE1BC,gBAF0B,WAE1BA,gBAF0B;AAAA,MAG1BC,gBAH0B,WAG1BA,gBAH0B;AAAA,MAI1BC,iBAJ0B,WAI1BA,iBAJ0B;AAAA,MAK1BC,QAL0B,WAK1BA,QAL0B;AAAA,MAM1BC,0BAN0B,WAM1BA,0BAN0B;AAAA,MAO1BC,WAP0B,WAO1BA,WAP0B;AAAA,MAQ1BC,iCAR0B,WAQ1BA,iCAR0B;;AAU3B,SAAO;AACNN,IAAAA,gBAAgB,EAAEA,gBAAgB,EAD5B;AAENC,IAAAA,gBAAgB,EAAEA,gBAAgB,EAF5B;AAGNE,IAAAA,QAAQ,EAAEA,QAAQ,EAHZ;AAINC,IAAAA,0BAA0B,EAAEA,0BAA0B,EAJhD;AAKNF,IAAAA,iBAAiB,EAAEA,iBAAiB,EAL9B;AAMNK,IAAAA,eAAe,EAAEF,WAAW,GAAGE,eANzB;AAONC,IAAAA,YAAY,EAAEF,iCAAiC;AAPzC,GAAP;AASA;;AAED,SAASG,YAAT,OASI;AAAA,MARHC,QAQG,QARHA,QAQG;AAAA,MAPHC,YAOG,QAPHA,YAOG;AAAA,MANHC,IAMG,QANHA,IAMG;AAAA,MALHC,KAKG,QALHA,KAKG;AAAA,MAJHC,OAIG,QAJHA,OAIG;AAAA,MAHHC,cAGG,QAHHA,cAGG;AAAA,MAFHC,mBAEG,QAFHA,mBAEG;AAAA,MADHC,iBACG,QADHA,iBACG;;AAAA,mBASC1B,SAAS,CAAEO,QAAF,EAAY,EAAZ,CATV;AAAA,MAEFE,gBAFE,cAEFA,gBAFE;AAAA,MAGFC,gBAHE,cAGFA,gBAHE;AAAA,MAIFE,QAJE,cAIFA,QAJE;AAAA,MAKFC,0BALE,cAKFA,0BALE;AAAA,MAMFF,iBANE,cAMFA,iBANE;AAAA,MAOFK,eAPE,cAOFA,eAPE;AAAA,MAQFC,YARE,cAQFA,YARE;;AAUH,MAAMU,eAAe,GAAGzB,gBAAgB,CAAE,QAAF,CAAxC;;AAVG,kBAW6CP,QAAQ,CAAE,KAAF,CAXrD;AAAA;AAAA,MAWKiC,eAXL;AAAA,MAWsBC,kBAXtB;;AAAA,mBAY6ClC,QAAQ,CAAE,KAAF,CAZrD;AAAA;AAAA,MAYKmC,eAZL;AAAA,MAYsBC,kBAZtB;;AAAA,oBAaoBlC,UAAU,CAAES,UAAF,CAb9B;AAAA;AAAA,MAaK0B,UAbL;;AAeH,MAAMC,0BAA0B,GAC/B,CAAExB,gBAAF,IAAsBgB,mBAAtB,IAA6CF,OAD9C;AAEA,MAAMW,oBAAoB,GAAGzB,gBAA7B;AACA,MAAM0B,2BAA2B,GAChC,CAAE1B,gBAAF,IACA,CAAEO,eADF,IAEAW,eAFA,IAGA,CAAEM,0BAHF,IAIA,CAAEvB,gBAJF,KAKE,CAAEE,QAAF,IAAcC,0BALhB,CADD;AAOA,MAAMuB,qBAAqB,GAC1B,CAAE3B,gBAAF,IACA,CAAE0B,2BADF,IAEA,CAAEnB,eAFF,IAGA,CAAES,mBAJH;AAMAxB,EAAAA,WAAW,CACV,iCADU,EAEVL,WAAW,CAAE;AAAA,WAAMiC,kBAAkB,CAAE,IAAF,CAAxB;AAAA,GAAF,EAAoC,EAApC,CAFD,EAGV;AACCQ,IAAAA,UAAU,EAAE,IADb;AAECC,IAAAA,SAAS,EAAE,SAFZ;AAGCC,IAAAA,UAAU,EAAE,CAAEH;AAHf,GAHU,CAAX;;AAUA,MACC,CAAEF,oBAAF,IACA,CAAEC,2BADF,IAEA,CAAEP,eAFF,IAGA,CAAEK,0BAJH,EAKE;AACD,WAAO,IAAP;AACA;;AAED,MAAIO,IAAI,GAAGR,UAAU,CAAEb,QAAF,CAArB;;AAEA,MAAKO,iBAAL,EAAyB;AACxBc,IAAAA,IAAI,GAAGC,QAAQ,CAACC,cAAT,CAAyB,WAAWhB,iBAApC,CAAP;AACA;;AAED,MAAK,CAAEc,IAAP,EAAc;AACb,WAAO,IAAP;AACA,GA1DE,CA4DH;;;AACA,MAAKA,IAAI,CAACG,SAAL,CAAeC,QAAf,CAAyB,oBAAzB,CAAL,EAAuD;AACtDJ,IAAAA,IAAI,GAAGA,IAAI,CAACK,aAAL,CAAoB,mBAApB,KAA6CL,IAApD;AACA;;AAED,MAAIM,SAAS,GAAGN,IAAhB;;AAEA,MAAK7B,iBAAL,EAAyB;AACxB,QAAMoC,UAAU,GAAGf,UAAU,CAAEf,YAAF,CAA7B,CADwB,CAGxB;AACA;;AACA,QAAK,CAAE8B,UAAP,EAAoB;AACnB,aAAO,IAAP;AACA;;AAEDD,IAAAA,SAAS,GAAG;AACXE,MAAAA,GAAG,EAAER,IADM;AAEXS,MAAAA,MAAM,EAAEF;AAFG,KAAZ;AAIA;;AAED,WAASG,OAAT,GAAmB;AAClBnB,IAAAA,kBAAkB,CAAE,IAAF,CAAlB;AACA;;AAED,WAASoB,MAAT,GAAkB;AACjBpB,IAAAA,kBAAkB,CAAE,KAAF,CAAlB;AACA,GAxFE,CA0FH;AACA;AACA;AACA;;;AACA,MAAMqB,eAAe,GAAGnB,0BAA0B,GAC/C,gBAD+C,GAE/C,gBAFH;AAIA,SACC,cAAC,OAAD;AACC,IAAA,OAAO,MADR;AAEC,IAAA,OAAO,EAAG,KAFX;AAGC,IAAA,QAAQ,EAAGmB,eAHZ;AAIC,IAAA,YAAY,EAAG,KAJhB;AAKC,IAAA,SAAS,EAAGN,SALb;AAMC,IAAA,SAAS,EAAC,wCANX;AAOC,IAAA,gBAAgB,EAAG,CAAEb,0BAPtB;AAQC,IAAA,kBAAkB,EAAC,eARpB,CASC;AATD;AAUC,IAAA,uCAAuC,EACtCT,cAAc,KAAK,YAAnB,IAAmCgB,IAXrC;AAaC,IAAA,yCAAyC,EACxChB,cAAc,KAAK,YAAnB,IAAmCgB,IAdrC;AAgBC,IAAA,MAAM,EAAG;AAAA,aAAMX,kBAAkB,CAAE,KAAF,CAAxB;AAAA,KAhBV;AAiBC,IAAA,0BAA0B;AAjB3B,KAmBG,CAAEM,2BAA2B,IAAIP,eAAjC,KACD;AACC,IAAA,OAAO,EAAGsB,OADX;AAEC,IAAA,MAAM,EAAGC,MAFV,CAGC;AACA;AACA;AACA;AACA;AACA;AARD;AASC,IAAA,QAAQ,EAAG,CAAC,CATb;AAUC,IAAA,SAAS,EAAGzD,UAAU,CACrB,iDADqB,EAErB;AACC,oBAAcoC;AADf,KAFqB;AAVvB,KAiBC,cAAC,QAAD;AACC,IAAA,QAAQ,EAAGX,QADZ;AAEC,IAAA,YAAY,EAAGC;AAFhB,IAjBD,CApBF,EA2CG,CAAEe,2BAA2B,IAAIP,eAAjC,KACD,cAAC,sBAAD,CACC;AACA;AAFD;AAGC,IAAA,YAAY,EAAGA,eAHhB;AAIC,iBAAYP,IAJb;AAKC,kBAAaC;AALd,IA5CF,EAoDGY,oBAAoB,IACrB,cAAC,eAAD;AACC,IAAA,QAAQ,EAAGf,QADZ;AAEC,IAAA,YAAY,EAAGC,YAFhB;AAGC,IAAA,cAAc,EAAGI,cAHlB;AAIC,kBAAaF;AAJd,IArDF,EA4DGW,0BAA0B,IAC3B;AAAK,IAAA,SAAS,EAAC;AAAf,KACC,cAAC,QAAD;AACC,IAAA,QAAQ,EAAC,WADV;AAEC,IAAA,YAAY,EAAGb,YAFhB;AAGC,IAAA,QAAQ,EAAGD;AAHZ,IADD,CA7DF,CADD;AAwEA;;AAED,SAASkC,eAAT,CAA0B7C,MAA1B,EAAmC;AAAA,iBAS9BA,MAAM,CAAE,mBAAF,CATwB;AAAA,MAEjC8C,wBAFiC,YAEjCA,wBAFiC;AAAA,MAGjCC,kCAHiC,YAGjCA,kCAHiC;AAAA,MAIjCC,oBAJiC,YAIjCA,oBAJiC;AAAA,MAKjCC,oCALiC,YAKjCA,oCALiC;AAAA,MAMjCC,eANiC,YAMjCA,eANiC;AAAA,MAOjCC,oBAPiC,YAOjCA,oBAPiC;AAAA,MAQjCC,2CARiC,YAQjCA,2CARiC;;AAWlC,MAAMzC,QAAQ,GACbmC,wBAAwB,MAAMC,kCAAkC,EADjE;;AAGA,MAAK,CAAEpC,QAAP,EAAkB;AACjB;AACA;;AAED,MAAMC,YAAY,GAAGoC,oBAAoB,CAAErC,QAAF,CAAzC;;AAlBkC,cAoBjCsC,oCAAoC,CAAEtC,QAAF,CAApC,IAAoD,EApBnB;AAAA,MAmB1BE,IAnB0B,SAmB1BA,IAnB0B;AAAA,+BAmBpBwC,UAnBoB;AAAA,MAmBpBA,UAnBoB,iCAmBP,EAnBO;AAAA,MAmBHtC,OAnBG,SAmBHA,OAnBG;;AAqBlC,MAAMuC,qBAAqB,GAAGJ,eAAe,CAAEvC,QAAF,CAA7C;;AArBkC,cAuBjCwC,oBAAoB,CAAEvC,YAAF,CAApB,IAAwC,EAvBP;AAAA,MAsB1B2C,4BAtB0B,SAsB1BA,4BAtB0B,EAyBlC;;;AACA,MAAMC,yBAAyB,GAAGJ,2CAA2C,CAC5EE,qBAD4E,CAA7E,CA1BkC,CA8BlC;AACA;;;AACA,MAAMG,kDAAkD,GAAGxE,SAAS,CACnEuE,yBADmE,EAEnE,CAAE,+BAAF,EAAmC,IAAnC,CAFmE,CAApE;AAKA,MAAItC,iBAAJ;;AAEA,MAAKuC,kDAAkD,KAAK,CAAC,CAA7D,EAAiE;AAChEvC,IAAAA,iBAAiB,GAChBoC,qBAAqB,CACpBG,kDADoB,CADtB;AAIA;;AAED,SAAO;AACN9C,IAAAA,QAAQ,EAARA,QADM;AAENC,IAAAA,YAAY,EAAEoC,oBAAoB,CAAErC,QAAF,CAF5B;AAGNE,IAAAA,IAAI,EAAJA,IAHM;AAINC,IAAAA,KAAK,EAAEuC,UAAU,CAACvC,KAJZ;AAKNC,IAAAA,OAAO,EAAPA,OALM;AAMNC,IAAAA,cAAc,EAAEuC,4BANV;AAONtC,IAAAA,mBAAmB,EAClBJ,IAAI,IAAIvB,wBAAwB,CAAE;AAAEuB,MAAAA,IAAI,EAAJA,IAAF;AAAQwC,MAAAA,UAAU,EAAVA;AAAR,KAAF,CAR3B;AASNnC,IAAAA,iBAAiB,EAAjBA;AATM,GAAP;AAWA;;AAED,eAAe,SAASwC,mBAAT,GAA+B;AAC7C,MAAMC,QAAQ,GAAGnE,SAAS,CAAEqD,eAAF,EAAmB,EAAnB,CAA1B;;AAEA,MAAK,CAAEc,QAAP,EAAkB;AACjB,WAAO,IAAP;AACA;;AAL4C,MAQ5ChD,QAR4C,GAgBzCgD,QAhByC,CAQ5ChD,QAR4C;AAAA,MAS5CC,YAT4C,GAgBzC+C,QAhByC,CAS5C/C,YAT4C;AAAA,MAU5CC,IAV4C,GAgBzC8C,QAhByC,CAU5C9C,IAV4C;AAAA,MAW5CC,KAX4C,GAgBzC6C,QAhByC,CAW5C7C,KAX4C;AAAA,MAY5CC,OAZ4C,GAgBzC4C,QAhByC,CAY5C5C,OAZ4C;AAAA,MAa5CC,cAb4C,GAgBzC2C,QAhByC,CAa5C3C,cAb4C;AAAA,MAc5CC,mBAd4C,GAgBzC0C,QAhByC,CAc5C1C,mBAd4C;AAAA,MAe5CC,iBAf4C,GAgBzCyC,QAhByC,CAe5CzC,iBAf4C;;AAkB7C,MAAK,CAAEL,IAAP,EAAc;AACb,WAAO,IAAP;AACA;;AAED,SACC,cAAC,YAAD;AACC,IAAA,QAAQ,EAAGF,QADZ;AAEC,IAAA,YAAY,EAAGC,YAFhB;AAGC,IAAA,IAAI,EAAGC,IAHR;AAIC,IAAA,KAAK,EAAGC,KAJT;AAKC,IAAA,OAAO,EAAGC,OALX;AAMC,IAAA,cAAc,EAAGC,cANlB;AAOC,IAAA,mBAAmB,EAAGC,mBAPvB;AAQC,IAAA,iBAAiB,EAAGC;AARrB,IADD;AAYA","sourcesContent":["/**\n * External dependencies\n */\nimport { findIndex } from 'lodash';\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { useState, useCallback, useContext } from '@wordpress/element';\nimport { isUnmodifiedDefaultBlock } from '@wordpress/blocks';\nimport { Popover } from '@wordpress/components';\nimport { useSelect } from '@wordpress/data';\nimport { useShortcut } from '@wordpress/keyboard-shortcuts';\nimport { useViewportMatch } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport BlockBreadcrumb from './breadcrumb';\nimport BlockContextualToolbar from './block-contextual-toolbar';\nimport Inserter from '../inserter';\nimport { BlockNodes } from './root-container';\n\nfunction selector( select ) {\n\tconst {\n\t\tisNavigationMode,\n\t\tisMultiSelecting,\n\t\thasMultiSelection,\n\t\tisTyping,\n\t\tisCaretWithinFormattedText,\n\t\tgetSettings,\n\t\tgetLastMultiSelectedBlockClientId,\n\t} = select( 'core/block-editor' );\n\treturn {\n\t\tisNavigationMode: isNavigationMode(),\n\t\tisMultiSelecting: isMultiSelecting(),\n\t\tisTyping: isTyping(),\n\t\tisCaretWithinFormattedText: isCaretWithinFormattedText(),\n\t\thasMultiSelection: hasMultiSelection(),\n\t\thasFixedToolbar: getSettings().hasFixedToolbar,\n\t\tlastClientId: getLastMultiSelectedBlockClientId(),\n\t};\n}\n\nfunction BlockPopover( {\n\tclientId,\n\trootClientId,\n\tname,\n\talign,\n\tisValid,\n\tmoverDirection,\n\tisEmptyDefaultBlock,\n\tcapturingClientId,\n} ) {\n\tconst {\n\t\tisNavigationMode,\n\t\tisMultiSelecting,\n\t\tisTyping,\n\t\tisCaretWithinFormattedText,\n\t\thasMultiSelection,\n\t\thasFixedToolbar,\n\t\tlastClientId,\n\t} = useSelect( selector, [] );\n\tconst isLargeViewport = useViewportMatch( 'medium' );\n\tconst [ isToolbarForced, setIsToolbarForced ] = useState( false );\n\tconst [ isInserterShown, setIsInserterShown ] = useState( false );\n\tconst [ blockNodes ] = useContext( BlockNodes );\n\n\tconst showEmptyBlockSideInserter =\n\t\t! isNavigationMode && isEmptyDefaultBlock && isValid;\n\tconst shouldShowBreadcrumb = isNavigationMode;\n\tconst shouldShowContextualToolbar =\n\t\t! isNavigationMode &&\n\t\t! hasFixedToolbar &&\n\t\tisLargeViewport &&\n\t\t! showEmptyBlockSideInserter &&\n\t\t! isMultiSelecting &&\n\t\t( ! isTyping || isCaretWithinFormattedText );\n\tconst canFocusHiddenToolbar =\n\t\t! isNavigationMode &&\n\t\t! shouldShowContextualToolbar &&\n\t\t! hasFixedToolbar &&\n\t\t! isEmptyDefaultBlock;\n\n\tuseShortcut(\n\t\t'core/block-editor/focus-toolbar',\n\t\tuseCallback( () => setIsToolbarForced( true ), [] ),\n\t\t{\n\t\t\tbindGlobal: true,\n\t\t\teventName: 'keydown',\n\t\t\tisDisabled: ! canFocusHiddenToolbar,\n\t\t}\n\t);\n\n\tif (\n\t\t! shouldShowBreadcrumb &&\n\t\t! shouldShowContextualToolbar &&\n\t\t! isToolbarForced &&\n\t\t! showEmptyBlockSideInserter\n\t) {\n\t\treturn null;\n\t}\n\n\tlet node = blockNodes[ clientId ];\n\n\tif ( capturingClientId ) {\n\t\tnode = document.getElementById( 'block-' + capturingClientId );\n\t}\n\n\tif ( ! node ) {\n\t\treturn null;\n\t}\n\n\t// A block may specify a different target element for the toolbar.\n\tif ( node.classList.contains( 'is-block-collapsed' ) ) {\n\t\tnode = node.querySelector( '.is-block-content' ) || node;\n\t}\n\n\tlet anchorRef = node;\n\n\tif ( hasMultiSelection ) {\n\t\tconst bottomNode = blockNodes[ lastClientId ];\n\n\t\t// Wait to render the popover until the bottom reference is available\n\t\t// as well.\n\t\tif ( ! bottomNode ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tanchorRef = {\n\t\t\ttop: node,\n\t\t\tbottom: bottomNode,\n\t\t};\n\t}\n\n\tfunction onFocus() {\n\t\tsetIsInserterShown( true );\n\t}\n\n\tfunction onBlur() {\n\t\tsetIsInserterShown( false );\n\t}\n\n\t// Position above the anchor, pop out towards the right, and position in the\n\t// left corner. For the side inserter, pop out towards the left, and\n\t// position in the right corner.\n\t// To do: refactor `Popover` to make this prop clearer.\n\tconst popoverPosition = showEmptyBlockSideInserter\n\t\t? 'top left right'\n\t\t: 'top right left';\n\n\treturn (\n\t\t<Popover\n\t\t\tnoArrow\n\t\t\tanimate={ false }\n\t\t\tposition={ popoverPosition }\n\t\t\tfocusOnMount={ false }\n\t\t\tanchorRef={ anchorRef }\n\t\t\tclassName=\"block-editor-block-list__block-popover\"\n\t\t\t__unstableSticky={ ! showEmptyBlockSideInserter }\n\t\t\t__unstableSlotName=\"block-toolbar\"\n\t\t\t// Allow subpixel positioning for the block movement animation.\n\t\t\t__unstableAllowVerticalSubpixelPosition={\n\t\t\t\tmoverDirection !== 'horizontal' && node\n\t\t\t}\n\t\t\t__unstableAllowHorizontalSubpixelPosition={\n\t\t\t\tmoverDirection === 'horizontal' && node\n\t\t\t}\n\t\t\tonBlur={ () => setIsToolbarForced( false ) }\n\t\t\tshouldAnchorIncludePadding\n\t\t>\n\t\t\t{ ( shouldShowContextualToolbar || isToolbarForced ) && (\n\t\t\t\t<div\n\t\t\t\t\tonFocus={ onFocus }\n\t\t\t\t\tonBlur={ onBlur }\n\t\t\t\t\t// While ideally it would be enough to capture the\n\t\t\t\t\t// bubbling focus event from the Inserter, due to the\n\t\t\t\t\t// characteristics of click focusing of `button`s in\n\t\t\t\t\t// Firefox and Safari, it is not reliable.\n\t\t\t\t\t//\n\t\t\t\t\t// See: https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#Clicking_and_focus\n\t\t\t\t\ttabIndex={ -1 }\n\t\t\t\t\tclassName={ classnames(\n\t\t\t\t\t\t'block-editor-block-list__block-popover-inserter',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'is-visible': isInserterShown,\n\t\t\t\t\t\t}\n\t\t\t\t\t) }\n\t\t\t\t>\n\t\t\t\t\t<Inserter\n\t\t\t\t\t\tclientId={ clientId }\n\t\t\t\t\t\trootClientId={ rootClientId }\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t) }\n\t\t\t{ ( shouldShowContextualToolbar || isToolbarForced ) && (\n\t\t\t\t<BlockContextualToolbar\n\t\t\t\t\t// If the toolbar is being shown because of being forced\n\t\t\t\t\t// it should focus the toolbar right after the mount.\n\t\t\t\t\tfocusOnMount={ isToolbarForced }\n\t\t\t\t\tdata-type={ name }\n\t\t\t\t\tdata-align={ align }\n\t\t\t\t/>\n\t\t\t) }\n\t\t\t{ shouldShowBreadcrumb && (\n\t\t\t\t<BlockBreadcrumb\n\t\t\t\t\tclientId={ clientId }\n\t\t\t\t\trootClientId={ rootClientId }\n\t\t\t\t\tmoverDirection={ moverDirection }\n\t\t\t\t\tdata-align={ align }\n\t\t\t\t/>\n\t\t\t) }\n\t\t\t{ showEmptyBlockSideInserter && (\n\t\t\t\t<div className=\"block-editor-block-list__empty-block-inserter\">\n\t\t\t\t\t<Inserter\n\t\t\t\t\t\tposition=\"top right\"\n\t\t\t\t\t\trootClientId={ rootClientId }\n\t\t\t\t\t\tclientId={ clientId }\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t) }\n\t\t</Popover>\n\t);\n}\n\nfunction wrapperSelector( select ) {\n\tconst {\n\t\tgetSelectedBlockClientId,\n\t\tgetFirstMultiSelectedBlockClientId,\n\t\tgetBlockRootClientId,\n\t\t__unstableGetBlockWithoutInnerBlocks,\n\t\tgetBlockParents,\n\t\tgetBlockListSettings,\n\t\t__experimentalGetBlockListSettingsForBlocks,\n\t} = select( 'core/block-editor' );\n\n\tconst clientId =\n\t\tgetSelectedBlockClientId() || getFirstMultiSelectedBlockClientId();\n\n\tif ( ! clientId ) {\n\t\treturn;\n\t}\n\n\tconst rootClientId = getBlockRootClientId( clientId );\n\tconst { name, attributes = {}, isValid } =\n\t\t__unstableGetBlockWithoutInnerBlocks( clientId ) || {};\n\tconst blockParentsClientIds = getBlockParents( clientId );\n\tconst { __experimentalMoverDirection } =\n\t\tgetBlockListSettings( rootClientId ) || {};\n\n\t// Get Block List Settings for all ancestors of the current Block clientId\n\tconst ancestorBlockListSettings = __experimentalGetBlockListSettingsForBlocks(\n\t\tblockParentsClientIds\n\t);\n\n\t// Find the index of the first Block with the `captureDescendantsToolbars` prop defined\n\t// This will be the top most ancestor because getBlockParents() returns tree from top -> bottom\n\tconst topmostAncestorWithCaptureDescendantsToolbarsIndex = findIndex(\n\t\tancestorBlockListSettings,\n\t\t[ '__experimentalCaptureToolbars', true ]\n\t);\n\n\tlet capturingClientId;\n\n\tif ( topmostAncestorWithCaptureDescendantsToolbarsIndex !== -1 ) {\n\t\tcapturingClientId =\n\t\t\tblockParentsClientIds[\n\t\t\t\ttopmostAncestorWithCaptureDescendantsToolbarsIndex\n\t\t\t];\n\t}\n\n\treturn {\n\t\tclientId,\n\t\trootClientId: getBlockRootClientId( clientId ),\n\t\tname,\n\t\talign: attributes.align,\n\t\tisValid,\n\t\tmoverDirection: __experimentalMoverDirection,\n\t\tisEmptyDefaultBlock:\n\t\t\tname && isUnmodifiedDefaultBlock( { name, attributes } ),\n\t\tcapturingClientId,\n\t};\n}\n\nexport default function WrappedBlockPopover() {\n\tconst selected = useSelect( wrapperSelector, [] );\n\n\tif ( ! selected ) {\n\t\treturn null;\n\t}\n\n\tconst {\n\t\tclientId,\n\t\trootClientId,\n\t\tname,\n\t\talign,\n\t\tisValid,\n\t\tmoverDirection,\n\t\tisEmptyDefaultBlock,\n\t\tcapturingClientId,\n\t} = selected;\n\n\tif ( ! name ) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<BlockPopover\n\t\t\tclientId={ clientId }\n\t\t\trootClientId={ rootClientId }\n\t\t\tname={ name }\n\t\t\talign={ align }\n\t\t\tisValid={ isValid }\n\t\t\tmoverDirection={ moverDirection }\n\t\t\tisEmptyDefaultBlock={ isEmptyDefaultBlock }\n\t\t\tcapturingClientId={ capturingClientId }\n\t\t/>\n\t);\n}\n"]}