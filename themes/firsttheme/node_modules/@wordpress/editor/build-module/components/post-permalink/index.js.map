{"version":3,"sources":["@wordpress/editor/src/components/post-permalink/index.js"],"names":["classnames","get","withDispatch","withSelect","Component","__","compose","ClipboardButton","Button","ExternalLink","safeDecodeURI","safeDecodeURIComponent","link","linkIcon","PostPermalinkEditor","cleanForSlug","PostPermalink","arguments","addVisibilityCheck","bind","onVisibilityChange","state","isCopied","isEditingPermalink","window","addEventListener","props","isEditable","refreshPost","document","visibilityState","prevProps","prevState","linkElement","focus","removeEventListener","isNew","isPublished","isViewable","permalinkParts","postLink","postSlug","postID","postTitle","ariaLabel","prefix","suffix","slug","samplePermalink","setState","select","isEditedPostNew","isPermalinkEditable","getCurrentPost","getPermalinkParts","getEditedPostAttribute","isCurrentPostPublished","getPostType","id","postTypeName","postType","dispatch"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\nimport { get } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { withDispatch, withSelect } from '@wordpress/data';\nimport { Component } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\nimport { compose } from '@wordpress/compose';\nimport { ClipboardButton, Button, ExternalLink } from '@wordpress/components';\nimport { safeDecodeURI, safeDecodeURIComponent } from '@wordpress/url';\nimport { link as linkIcon } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport PostPermalinkEditor from './editor.js';\nimport { cleanForSlug } from '../../utils/url';\n\nclass PostPermalink extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.addVisibilityCheck = this.addVisibilityCheck.bind( this );\n\t\tthis.onVisibilityChange = this.onVisibilityChange.bind( this );\n\n\t\tthis.state = {\n\t\t\tisCopied: false,\n\t\t\tisEditingPermalink: false,\n\t\t};\n\t}\n\n\taddVisibilityCheck() {\n\t\twindow.addEventListener( 'visibilitychange', this.onVisibilityChange );\n\t}\n\n\tonVisibilityChange() {\n\t\tconst { isEditable, refreshPost } = this.props;\n\t\t// If the user just returned after having clicked the \"Change Permalinks\" button,\n\t\t// fetch a new copy of the post from the server, just in case they enabled permalinks.\n\t\tif ( ! isEditable && 'visible' === document.visibilityState ) {\n\t\t\trefreshPost();\n\t\t}\n\t}\n\n\tcomponentDidUpdate( prevProps, prevState ) {\n\t\t// If we've just stopped editing the permalink, focus on the new permalink.\n\t\tif ( prevState.isEditingPermalink && ! this.state.isEditingPermalink ) {\n\t\t\tthis.linkElement.focus();\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\twindow.removeEventListener(\n\t\t\t'visibilitychange',\n\t\t\tthis.addVisibilityCheck\n\t\t);\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tisEditable,\n\t\t\tisNew,\n\t\t\tisPublished,\n\t\t\tisViewable,\n\t\t\tpermalinkParts,\n\t\t\tpostLink,\n\t\t\tpostSlug,\n\t\t\tpostID,\n\t\t\tpostTitle,\n\t\t} = this.props;\n\n\t\tif ( isNew || ! isViewable || ! permalinkParts || ! postLink ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst { isCopied, isEditingPermalink } = this.state;\n\t\tconst ariaLabel = isCopied\n\t\t\t? __( 'Permalink copied' )\n\t\t\t: __( 'Copy the permalink' );\n\n\t\tconst { prefix, suffix } = permalinkParts;\n\t\tconst slug =\n\t\t\tsafeDecodeURIComponent( postSlug ) ||\n\t\t\tcleanForSlug( postTitle ) ||\n\t\t\tpostID;\n\t\tconst samplePermalink = isEditable ? prefix + slug + suffix : prefix;\n\n\t\treturn (\n\t\t\t<div className=\"editor-post-permalink\">\n\t\t\t\t<ClipboardButton\n\t\t\t\t\tclassName={ classnames( 'editor-post-permalink__copy', {\n\t\t\t\t\t\t'is-copied': isCopied,\n\t\t\t\t\t} ) }\n\t\t\t\t\ttext={ samplePermalink }\n\t\t\t\t\tlabel={ ariaLabel }\n\t\t\t\t\tonCopy={ () => this.setState( { isCopied: true } ) }\n\t\t\t\t\taria-disabled={ isCopied }\n\t\t\t\t\ticon={ linkIcon }\n\t\t\t\t/>\n\n\t\t\t\t<span className=\"editor-post-permalink__label\">\n\t\t\t\t\t{ __( 'Permalink:' ) }\n\t\t\t\t</span>\n\n\t\t\t\t{ ! isEditingPermalink && (\n\t\t\t\t\t<ExternalLink\n\t\t\t\t\t\tclassName=\"editor-post-permalink__link\"\n\t\t\t\t\t\thref={ ! isPublished ? postLink : samplePermalink }\n\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\tref={ ( linkElement ) =>\n\t\t\t\t\t\t\t( this.linkElement = linkElement )\n\t\t\t\t\t\t}\n\t\t\t\t\t>\n\t\t\t\t\t\t{ safeDecodeURI( samplePermalink ) }\n\t\t\t\t\t\t&lrm;\n\t\t\t\t\t</ExternalLink>\n\t\t\t\t) }\n\n\t\t\t\t{ isEditingPermalink && (\n\t\t\t\t\t<PostPermalinkEditor\n\t\t\t\t\t\tslug={ slug }\n\t\t\t\t\t\tonSave={ () =>\n\t\t\t\t\t\t\tthis.setState( { isEditingPermalink: false } )\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t) }\n\n\t\t\t\t{ isEditable && ! isEditingPermalink && (\n\t\t\t\t\t<Button\n\t\t\t\t\t\tclassName=\"editor-post-permalink__edit\"\n\t\t\t\t\t\tisSecondary\n\t\t\t\t\t\tonClick={ () =>\n\t\t\t\t\t\t\tthis.setState( { isEditingPermalink: true } )\n\t\t\t\t\t\t}\n\t\t\t\t\t>\n\t\t\t\t\t\t{ __( 'Edit' ) }\n\t\t\t\t\t</Button>\n\t\t\t\t) }\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select ) => {\n\t\tconst {\n\t\t\tisEditedPostNew,\n\t\t\tisPermalinkEditable,\n\t\t\tgetCurrentPost,\n\t\t\tgetPermalinkParts,\n\t\t\tgetEditedPostAttribute,\n\t\t\tisCurrentPostPublished,\n\t\t} = select( 'core/editor' );\n\t\tconst { getPostType } = select( 'core' );\n\n\t\tconst { id, link } = getCurrentPost();\n\n\t\tconst postTypeName = getEditedPostAttribute( 'type' );\n\t\tconst postType = getPostType( postTypeName );\n\n\t\treturn {\n\t\t\tisNew: isEditedPostNew(),\n\t\t\tpostLink: link,\n\t\t\tpermalinkParts: getPermalinkParts(),\n\t\t\tpostSlug: getEditedPostAttribute( 'slug' ),\n\t\t\tisEditable: isPermalinkEditable(),\n\t\t\tisPublished: isCurrentPostPublished(),\n\t\t\tpostTitle: getEditedPostAttribute( 'title' ),\n\t\t\tpostID: id,\n\t\t\tisViewable: get( postType, [ 'viewable' ], false ),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst { refreshPost } = dispatch( 'core/editor' );\n\t\treturn { refreshPost };\n\t} ),\n] )( PostPermalink );\n"]}